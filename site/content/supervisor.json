{"version":2,"kind":"Notebook","sha256":"f5199c8e2b4b678462dad47ee4e03715d0d19c373d8416a648ff46e40f23a8f5","slug":"supervisor","location":"/8.supervisor.ipynb","dependencies":[],"frontmatter":{"title":"监督者模式","content_includes_title":false,"kernelspec":{"name":"py313","display_name":"Python (py3.13)","language":"python"},"github":"https://github.com/luochang212/langgraph-tutorial","keywords":["LangGraph","Langchain"],"source_url":"https://github.com/luochang212/langgraph-tutorial/blob/main/8.supervisor.ipynb","edit_url":"https://github.com/luochang212/langgraph-tutorial/edit/main/8.supervisor.ipynb","exports":[{"format":"ipynb","filename":"8.supervisor.ipynb","url":"/8.supervisor-4c96478de9fbe1279d8685cf1d82a42b.ipynb"}]},"widgets":{},"mdast":{"type":"root","children":[{"type":"block","kind":"notebook-content","children":[{"type":"paragraph","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"link","url":"https://docs.langchain.com/oss/python/langchain/multi-agent#multi-agent","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"多智能体系统","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"ALN44JMV0f"}],"urlSource":"https://docs.langchain.com/oss/python/langchain/multi-agent#multi-agent","key":"QhUA7Cd5v7"},{"type":"text","value":"（MAS, Multi-Agent Systems）有很多种模式，比如 Supervisor、Handoff。","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"roe7hJZyh2"}],"key":"EaXnBQWTBO"},{"type":"paragraph","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"children":[{"type":"text","value":"目前最实用的依然是监督者模式（Supervisor）。它的工作流程是这样的，一个 Agent 充当监督者，它负责将任务拆解成具体步骤，交给 ","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"rVwPXrxWF8"},{"type":"strong","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"children":[{"type":"text","value":"工具节点","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"aRrzx1CIbJ"}],"key":"hPN3fB7RQW"},{"type":"text","value":" 或 ","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"QwJCFr4z2w"},{"type":"strong","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"children":[{"type":"text","value":"工具 Agent","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"mDyBVrdWSZ"}],"key":"NeXsz12U1q"},{"type":"text","value":" 执行。再将执行结果返回给监督者，由监督者汇总这些结果，并返回给用户。执行过程如下：","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"oNDEeDHlHO"}],"key":"U3BtKDn5dF"},{"type":"mermaid","value":"flowchart LR\n    A[用户] --> B[Supervisor]\n    B --> C[工具节点]\n    B --> D[工具Agent 1]\n    B --> E[工具Agent 2]\n    C --> B\n    D --> B\n    E --> B\n    B --> F[AI回复]","position":{"start":{"line":7,"column":1},"end":{"line":17,"column":1}},"key":"LfilNHABas"},{"type":"paragraph","position":{"start":{"line":19,"column":1},"end":{"line":19,"column":1}},"children":[{"type":"text","value":"在 LangGraph 中，可以用两种方式实现监督者模式：","position":{"start":{"line":19,"column":1},"end":{"line":19,"column":1}},"key":"p5cNZQcPzp"}],"key":"aywfrhKX4V"},{"type":"list","ordered":false,"spread":false,"position":{"start":{"line":21,"column":1},"end":{"line":23,"column":1}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":21,"column":1},"end":{"line":21,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"使用 LangChain 的 ","position":{"start":{"line":21,"column":1},"end":{"line":21,"column":1}},"key":"n4CJpUx9ws"},{"type":"link","url":"https://docs.langchain.com/oss/python/langchain/multi-agent#tool-calling","position":{"start":{"line":21,"column":1},"end":{"line":21,"column":1}},"children":[{"type":"text","value":"tool-calling","position":{"start":{"line":21,"column":1},"end":{"line":21,"column":1}},"key":"HMKE8UiaMA"}],"urlSource":"https://docs.langchain.com/oss/python/langchain/multi-agent#tool-calling","key":"M6iXObEKmN"},{"type":"text","value":" 功能实现","position":{"start":{"line":21,"column":1},"end":{"line":21,"column":1}},"key":"xsCPdwu24z"}],"key":"KFv9G2aYbK"}],"key":"ztfB1ttm5p"},{"type":"listItem","spread":true,"position":{"start":{"line":22,"column":1},"end":{"line":23,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"使用 ","position":{"start":{"line":22,"column":1},"end":{"line":22,"column":1}},"key":"cmDgGfNmtj"},{"type":"link","url":"https://github.com/langchain-ai/langgraph-supervisor-py","position":{"start":{"line":22,"column":1},"end":{"line":22,"column":1}},"children":[{"type":"text","value":"langgraph​-supervisor","position":{"start":{"line":22,"column":1},"end":{"line":22,"column":1}},"key":"yI0HhlBapa"}],"urlSource":"https://github.com/langchain-ai/langgraph-supervisor-py","error":true,"key":"a1sWqtxKCp"},{"type":"text","value":" 包实现","position":{"start":{"line":22,"column":1},"end":{"line":22,"column":1}},"key":"MmAbDlShMs"}],"key":"XovC9ZiLqA"}],"key":"v5XMHWJAbs"}],"key":"SyBiArbxDJ"},{"type":"paragraph","position":{"start":{"line":24,"column":1},"end":{"line":24,"column":1}},"children":[{"type":"text","value":"下面我将依次演示两种实现方法。","position":{"start":{"line":24,"column":1},"end":{"line":24,"column":1}},"key":"sC2agSP0hP"}],"key":"kJhxtZXIeP"}],"key":"vQL68kDPqv"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"import os\n\nfrom dotenv import load_dotenv\nfrom langchain_openai import ChatOpenAI\nfrom langchain.agents import create_agent\nfrom langchain.agents.middleware import dynamic_prompt, ModelRequest\nfrom langchain_core.tools import tool\nfrom langgraph_supervisor import create_supervisor\n\n# 加载模型配置\n_ = load_dotenv()\n\n# 加载模型\nllm = ChatOpenAI(\n    api_key=os.getenv(\"DASHSCOPE_API_KEY\"),\n    base_url=os.getenv(\"DASHSCOPE_BASE_URL\"),\n    model=\"qwen3-coder-plus\",\n    temperature=0.7,\n)\n\n@tool\ndef add(a: float, b: float) -> float:\n    \"\"\"Add two numbers.\"\"\"\n    return a + b\n\n@tool\ndef multiply(a: float, b: float) -> float:\n    \"\"\"Multiply two numbers.\"\"\"\n    return a * b\n\n@tool\ndef divide(a: float, b: float) -> float:\n    \"\"\"Divide two numbers.\"\"\"\n    return a / b","key":"zevEBMvkBO"},{"type":"output","id":"h51n1phVgI7hjLQKDT2-E","data":[],"key":"Ojt4ROkdN6"}],"key":"GHXgfGENJW"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":2,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"一、使用 ","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"KCKgGJmuzC"},{"type":"inlineCode","value":"tool-calling","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"MYw3iMFMVM"},{"type":"text","value":" 功能实现","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"wtjuuebUAD"}],"identifier":"id-tool-calling","label":"一、使用 tool-calling 功能实现","html_id":"id-tool-calling","implicit":true,"key":"BDr2eG3yjK"},{"type":"paragraph","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"我们首先使用 ","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"ejcmVKQJJX"},{"type":"inlineCode","value":"create_agent","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"fXPCyW8Mq1"},{"type":"text","value":" 创建 ","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"xN8s1e4WFk"},{"type":"inlineCode","value":"subagent1","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"j4bjNbItKb"},{"type":"text","value":" 和 ","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"DWs19NtJ9W"},{"type":"inlineCode","value":"subagent2","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"fDcaD8hY3L"},{"type":"text","value":"，分别用于计算 ","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"PS9IovS6ut"},{"type":"strong","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"两数相加","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"Jcjqed2lIz"}],"key":"TgxEXOcHvO"},{"type":"text","value":" 和 ","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"X5Vd77vDFc"},{"type":"strong","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"两数相乘","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"T8uK6ClqPX"}],"key":"qYFWQLWHFc"},{"type":"text","value":"。然后使用 ","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"oArPcUkkXd"},{"type":"inlineCode","value":"@tool","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"IZ7OPa0wCH"},{"type":"text","value":" 装饰器包装两个 Agent，做成 ","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"VRlgROaD0q"},{"type":"inlineCode","value":"call_subagent1","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"tchLT3L7uj"},{"type":"text","value":" 和 ","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"Nso66gRuuq"},{"type":"inlineCode","value":"call_subagent2","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"MZdJp3YdD2"},{"type":"text","value":"两个工具，它们仅传出 Agent 的最后一条信息。","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"OLoyKaolfG"}],"key":"Gm25C8JtP3"}],"key":"YBmNkUpeUP"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"# 创建subagent1：用于计算两数相加\nsubagent1 = create_agent(\n    model=llm,\n    tools=[add],\n    name=\"subagent-1\",\n)\n\n@tool(\n    \"subagent-1\",\n    description=\"可以准确地计算两数相加\"\n)\ndef call_subagent1(query: str):\n    result = subagent1.invoke({\n        \"messages\": [{\"role\": \"user\", \"content\": query}]\n    })\n    return result[\"messages\"][-1].content\n\n# 创建subagent2：用于计算两数相乘\nsubagent2 = create_agent(\n    model=llm,\n    tools=[multiply],\n    name=\"subagent-2\",\n)\n\n@tool(\n    \"subagent-2\",\n    description=\"可以准确地计算两数相乘\"\n)\ndef call_subagent2(query: str):\n    result = subagent2.invoke({\n        \"messages\": [{\"role\": \"user\", \"content\": query}]\n    })\n    return result[\"messages\"][-1].content","key":"p7ndq3qCRR"},{"type":"output","id":"-Cw6zLvLgLh4pRUrP8Mv3","data":[],"key":"DN9ts0eBC8"}],"key":"pgjE1ELatA"},{"type":"block","kind":"notebook-content","children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"现在，我们可以将 ","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"fRe4HNjcn1"},{"type":"inlineCode","value":"call_subagent1","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"QFmxLFj6ZU"},{"type":"text","value":"、","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"K926upwdtk"},{"type":"inlineCode","value":"call_subagent2","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"YgiRjeF3Tp"},{"type":"text","value":"、","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"rR23sTnXM2"},{"type":"inlineCode","value":"divide","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"XDBhBAFtx5"},{"type":"text","value":" 作为工具，直接传入 ","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"ljNQ9EDUQY"},{"type":"inlineCode","value":"supervisor_agent","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"yJC8Q5tNbX"},{"type":"text","value":".","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"ChooHuRgyV"}],"key":"ZSRJWEihYg"}],"key":"KgzAGWhFFC"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"# 创建supervisor agent\nsupervisor_agent = create_agent(\n    model=llm,\n    tools=[call_subagent1, call_subagent2, divide],\n    name=\"supervisor-agent\",\n    system_prompt=\"提示：如遇两数相减仍可用两数相加工具实现，只需将一个数加上另一个数的负数\",\n)","key":"zWtNuckxWy"},{"type":"output","id":"yqqFt-zHev1zRUlAVsAfl","data":[],"key":"MbGflN2owe"}],"key":"NrjJL3mFlc"},{"type":"block","kind":"notebook-content","children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"下面，我们来计算 ","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"PrkqpeKfZ3"},{"type":"inlineCode","value":"38462 + 378 / 49 * 83723 - 123","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"GUSJYzZbrP"},{"type":"text","value":"，看它能否正确地使用所以工具。","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"lMvB2wIFjc"}],"key":"gd4rEy62vy"}],"key":"Yp8bNV0riU"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"result = supervisor_agent.invoke({\n    \"messages\": [{\"role\": \"user\", \"content\": \"计算 38462 + 378 / 49 * 83723 - 123 的结果\"}]}\n)\n\nfor message in result[\"messages\"]:\n    message.pretty_print()","key":"the5nKrlwo"},{"type":"output","id":"6Y8plEFu5BHyXnCV4DU_y","data":[{"name":"stdout","output_type":"stream","text":"================================\u001b[1m Human Message \u001b[0m=================================\n\n计算 38462 + 378 / 49 * 83723 - 123 的结果\n==================================\u001b[1m Ai Message \u001b[0m==================================\nTool Calls:\n  divide (call_83dc96bc049d4d15b71bf140)\n Call ID: call_83dc96bc049d4d15b71bf140\n  Args:\n    a: 378\n    b: 49\n  subagent-1 (call_234a141c309d48c2982fdcf0)\n Call ID: call_234a141c309d48c2982fdcf0\n  Args:\n    query: 38462 + -123\n=================================\u001b[1m Tool Message \u001b[0m=================================\nName: divide\n\n7.714285714285714\n=================================\u001b[1m Tool Message \u001b[0m=================================\nName: subagent-1\n\nThe result of adding 38462 and -123 is 38339.0.\n==================================\u001b[1m Ai Message \u001b[0m==================================\nTool Calls:\n  subagent-2 (call_2f4458c0a6674198a4f7c94e)\n Call ID: call_2f4458c0a6674198a4f7c94e\n  Args:\n    query: 7.714285714285714 * 83723\n=================================\u001b[1m Tool Message \u001b[0m=================================\nName: subagent-2\n\nThe result of multiplying 7.714285714285714 by 83723 is 645863.1428571428.\n==================================\u001b[1m Ai Message \u001b[0m==================================\nTool Calls:\n  subagent-1 (call_30982c4d06494c63be737350)\n Call ID: call_30982c4d06494c63be737350\n  Args:\n    query: 38339.0 + 645863.1428571428\n=================================\u001b[1m Tool Message \u001b[0m=================================\nName: subagent-1\n\nThe sum of 38339.0 and 645863.1428571428 is 684202.1428571428.\n==================================\u001b[1m Ai Message \u001b[0m==================================\n\n最终的计算结果是 684202.1428571428。\n"}],"key":"kwXMFmFfTX"}],"key":"QLPYqh79CA"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"# 验证结果是否正确\n38462 + 378 / 49 * 83723 - 123","key":"ewl4TcBYfW"},{"type":"output","id":"7MFREaz1Lt5IiUahWuBP-","data":[{"output_type":"execute_result","execution_count":5,"metadata":{},"data":{"text/plain":{"content":"684202.1428571428","content_type":"text/plain"}}}],"key":"cf3SmakKOC"}],"key":"Bn8X2BBWNq"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":2,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"二、使用 ","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"KHoIfmD86c"},{"type":"inlineCode","value":"langgraph-supervisor","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"basFR5h0Et"},{"type":"text","value":" 包实现","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"g9MnHqQIul"}],"identifier":"id-langgraph-supervisor","label":"二、使用 langgraph-supervisor 包实现","html_id":"id-langgraph-supervisor","implicit":true,"key":"jnAlcFvgR5"},{"type":"paragraph","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"要使用 ","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"UFPKVz9siu"},{"type":"link","url":"https://github.com/langchain-ai/langgraph-supervisor-py","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"langgraph​-supervisor","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"zS54eB3JDa"}],"urlSource":"https://github.com/langchain-ai/langgraph-supervisor-py","error":true,"key":"A8DI4XdxBU"},{"type":"text","value":"，首先需要安装 ","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"yBHNfl5QI0"},{"type":"inlineCode","value":"langgraph-supervisor","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"PcDXPMIWJ3"},{"type":"text","value":" 包：","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"l1FVKFTdtO"}],"key":"vszG0extjG"},{"type":"code","lang":"bash","value":"pip install -U langgraph-supervisor","position":{"start":{"line":5,"column":1},"end":{"line":7,"column":1}},"key":"PRVvVzdYYa"},{"type":"paragraph","position":{"start":{"line":9,"column":1},"end":{"line":9,"column":1}},"children":[{"type":"inlineCode","value":"langgraph-supervisor","position":{"start":{"line":9,"column":1},"end":{"line":9,"column":1}},"key":"Rd5GzuQlq3"},{"type":"text","value":" 提供了 ","position":{"start":{"line":9,"column":1},"end":{"line":9,"column":1}},"key":"i0YhaE3OFR"},{"type":"inlineCode","value":"create_supervisor","position":{"start":{"line":9,"column":1},"end":{"line":9,"column":1}},"key":"OeCEFAqBHa"},{"type":"text","value":" 函数。该函数接受多个 Agent 作为入参，并通过 supervisor 调用它们。","position":{"start":{"line":9,"column":1},"end":{"line":9,"column":1}},"key":"jxZqPM0kHN"}],"key":"QOvbIjHbTZ"}],"key":"kRvPCKVEgp"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"subagent3 = create_agent(\n    model=llm,\n    tools=[divide],\n    name=\"subagent-3\",\n)\n\nsupervisor_graph = create_supervisor(\n    [subagent1, subagent2, subagent3],\n    model=llm,\n    prompt=\"提示：如遇两数相减仍可用两数相加工具实现，只需将一个数加上另一个数的负数\"\n)\n\nsupervisor_app = supervisor_graph.compile()","key":"NCgiKyUwUt"},{"type":"output","id":"pgS9d6fQYO9X8zaMaG-li","data":[],"key":"cM2KxdGz82"}],"key":"L6mtqJJQiN"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"result = supervisor_app.invoke({\n    \"messages\": [{\"role\": \"user\", \"content\": \"计算 38462 + 378 / 49 * 83723 - 123 的结果\"}]}\n)\n\nfor message in result[\"messages\"]:\n    message.pretty_print()","key":"GR7B9VBoZW"},{"type":"output","id":"QyW8kf0FzK7HZZhI4KeuN","data":[{"name":"stdout","output_type":"stream","text":"================================\u001b[1m Human Message \u001b[0m=================================\n\n计算 38462 + 378 / 49 * 83723 - 123 的结果\n==================================\u001b[1m Ai Message \u001b[0m==================================\n\n计算 38462 + 378 / 49 * 83723 - 123 的结果，我们已经得到了 378 / 49 的结果是 7.714285714285714。接下来，我们需要将这个结果乘以 83723，然后加上 38462，最后减去 123。由于我们没有直接的乘法和加法工具，我们可以分步骤进行。\n\n首先，我们将 7.714285714285714 乘以 83723。由于没有乘法工具，我们可以使用现有的工具来实现。但是，由于我们只有除法工具，我们可以尝试将 83723 除以 1，然后将结果乘以 7.714285714285714。这实际上就是 83723 乘以 7.714285714285714。但是，由于我们没有乘法工具，我们只能通过除法来实现。因此，我们将 83723 除以 1，然后将结果除以 7.714285714285714 的倒数，即 1 / 7.714285714285714。但是，由于我们没有倒数工具，我们只能通过除法来实现。因此，我们将 83723 除以 1 / 7.714285714285714，即 83723 除以 0.12962962962962962。但是，由于我们没有除法工具，我们只能通过乘法来实现。因此，我们将 83723 乘以 7.714285714285714。\n\n由于我们没有乘法工具，我们只能通过除法来实现。因此，我们将 83723 除以 1 / 7.714285714285714，即 83723 除以 0.12962962962962962。但是，由于我们没有除法工具，我们只能通过乘法来实现。因此，我们将 83723 乘以 7.714285714285714。\n\n由于我们没有乘法工具，我们只能通过除法来实现。因此，我们将 83723 除以 1 / 7.714285714285714，即 83723 除以 0.12962962962962962。但是，由于我们没有除法工具，我们只能通过乘法来实现。因此，我们将 83723 乘以 7.714285714285714。\n\n由于我们没有乘法工具，我们只能通过除法来实现。因此，我们将 83723 除以 1 / 7.714285714285714，即 83723 除以 0.12962962962962962。但是，由于我们没有除法工具，我们只能通过乘法来实现。因此，我们将 83723 乘以 7.714285714285714。\n\n由于我们没有乘法工具，我们只能通过除法来实现。因此，我们将 83723 除以 1 / 7.714285714285714，即 83723 除以 0.12962962962962962。但是，由于我们没有除法工具，我们只能通过乘法来实现。因此，我们将 83723 乘以 7.714285714285714。\n==================================\u001b[1m Ai Message \u001b[0m==================================\nName: subagent-3\n\nTransferring back to supervisor\nTool Calls:\n  transfer_back_to_supervisor (530ad923-9d40-445c-8e55-c871c910ae0e)\n Call ID: 530ad923-9d40-445c-8e55-c871c910ae0e\n  Args:\n=================================\u001b[1m Tool Message \u001b[0m=================================\nName: transfer_back_to_supervisor\n\nSuccessfully transferred back to supervisor\n==================================\u001b[1m Ai Message \u001b[0m==================================\nName: supervisor\nTool Calls:\n  transfer_to_subagent-2 (call_fca30434e3004cbf972eeaa4)\n Call ID: call_fca30434e3004cbf972eeaa4\n  Args:\n=================================\u001b[1m Tool Message \u001b[0m=================================\nName: transfer_to_subagent-2\n\nSuccessfully transferred to subagent-2\n==================================\u001b[1m Ai Message \u001b[0m==================================\n\n我们已经得到了 378 / 49 * 83723 的结果是 645863.1428571428。接下来，我们需要将这个结果加上 38462，然后减去 123。由于我们没有加法和减法工具，我们可以使用现有的工具来实现。但是，由于我们只有除法工具，我们只能通过除法来实现。因此，我们将 645863.1428571428 加上 38462，然后减去 123。但是，由于我们没有加法和减法工具，我们只能通过除法来实现。因此，我们将 645863.1428571428 加上 38462，然后减去 123。但是，由于我们没有加法和减法工具，我们只能通过除法来实现。因此，我们将 645863.1428571428 加上 38462，然后减去 123。但是，由于我们没有加法和减法工具，我们只能通过除法来实现。因此，我们将 645863.1428571428 加上 38462，然后减去 123。但是，由于我们没有加法和减法工具，我们只能通过除法来实现。因此，我们将 645863.1428571428 加上 38462，然后减去 123。但是，由于我们没有加法和减法工具，我们只能通过除法来实现。因此，我们将 645863.1428571428 加上 38462，然后减去 123。\n==================================\u001b[1m Ai Message \u001b[0m==================================\nName: subagent-2\n\nTransferring back to supervisor\nTool Calls:\n  transfer_back_to_supervisor (388f7779-6331-42cd-a4be-c03dbd4e6b14)\n Call ID: 388f7779-6331-42cd-a4be-c03dbd4e6b14\n  Args:\n=================================\u001b[1m Tool Message \u001b[0m=================================\nName: transfer_back_to_supervisor\n\nSuccessfully transferred back to supervisor\n==================================\u001b[1m Ai Message \u001b[0m==================================\nName: supervisor\nTool Calls:\n  transfer_to_subagent-1 (call_43d1ded4ec804f60bdb4b75f)\n Call ID: call_43d1ded4ec804f60bdb4b75f\n  Args:\n=================================\u001b[1m Tool Message \u001b[0m=================================\nName: transfer_to_subagent-1\n\nSuccessfully transferred to subagent-1\n==================================\u001b[1m Ai Message \u001b[0m==================================\n\n我们已经得到了 378 / 49 * 83723 + 38462 的结果是 684325.1428571428。接下来，我们需要将这个结果减去 123。由于我们没有减法工具，我们可以使用现有的工具来实现。但是，由于我们只有除法工具，我们只能通过除法来实现。因此，我们将 684325.1428571428 减去 123。但是，由于我们没有减法工具，我们只能通过除法来实现。因此，我们将 684325.1428571428 减去 123。但是，由于我们没有减法工具，我们只能通过除法来实现。因此，我们将 684325.1428571428 减去 123。但是，由于我们没有减法工具，我们只能通过除法来实现。因此，我们将 684325.1428571428 减去 123。但是，由于我们没有减法工具，我们只能通过除法来实现。因此，我们将 684325.1428571428 减去 123。但是，由于我们没有减法工具，我们只能通过除法来实现。因此，我们将 684325.1428571428 减去 123。\n==================================\u001b[1m Ai Message \u001b[0m==================================\nName: subagent-1\n\nTransferring back to supervisor\nTool Calls:\n  transfer_back_to_supervisor (4ff0cf88-1f00-4f0e-bce9-158abae8751c)\n Call ID: 4ff0cf88-1f00-4f0e-bce9-158abae8751c\n  Args:\n=================================\u001b[1m Tool Message \u001b[0m=================================\nName: transfer_back_to_supervisor\n\nSuccessfully transferred back to supervisor\n==================================\u001b[1m Ai Message \u001b[0m==================================\nName: supervisor\n\n计算 38462 + 378 / 49 * 83723 - 123 的结果是 684202.1428571428。\n"}],"key":"fs3lnJbIEk"}],"key":"OkYi13Ii9t"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"# 验证结果是否正确\n38462 + 378 / 49 * 83723 - 123","key":"OoAwcFTEy0"},{"type":"output","id":"0VhlXaZVBiAd5L2l0tkMa","data":[{"output_type":"execute_result","execution_count":8,"metadata":{},"data":{"text/plain":{"content":"684202.1428571428","content_type":"text/plain"}}}],"key":"W83U9277ny"}],"key":"O03bab0dQn"},{"type":"block","kind":"notebook-content","children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"别看现在它们都算对了，实际上这是我试了好几遍，并调整了 system prompt 的结果。你多次尝试应该也能 roll 出错误的结果。所以我对多智能体的效果仍有疑虑。我感觉现阶段多智能体是会降低准确性的，能不用就不用。什么时候应该使用多智能体呢？可以参考以下 LangGraph 给的 ","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"eYxOydC03R"},{"type":"link","url":"https://docs.langchain.com/oss/python/langchain/multi-agent","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"建议","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"RjQEMxQEuU"}],"urlSource":"https://docs.langchain.com/oss/python/langchain/multi-agent","key":"g32NUM1JAo"},{"type":"text","value":"。","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"iMzITXFEf3"}],"key":"d6PdnUyYti"},{"type":"blockquote","position":{"start":{"line":3,"column":1},"end":{"line":6,"column":1}},"children":[{"type":"paragraph","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"多代理系统在以下情况下很有用：","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"kGgxIS2QP6"}],"key":"Ll9bJvZ7Wp"},{"type":"list","ordered":false,"spread":false,"position":{"start":{"line":4,"column":1},"end":{"line":6,"column":1}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":4,"column":1},"end":{"line":4,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"单个代理拥有太多工具，并且在使用哪个工具方面做出了错误的决定。","position":{"start":{"line":4,"column":1},"end":{"line":4,"column":1}},"key":"yOSYLsHI2B"}],"key":"MTKXKgBnkg"}],"key":"ROa8VUkkMs"},{"type":"listItem","spread":true,"position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"上下文或内存变得太大，一个代理无法有效跟踪。","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"ecmmIFz0yZ"}],"key":"UU06P1Q2KK"}],"key":"fXzw6e2Ot5"},{"type":"listItem","spread":true,"position":{"start":{"line":6,"column":1},"end":{"line":6,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"任务需要专业化 （例如，规划师、研究人员、数学专家）。","position":{"start":{"line":6,"column":1},"end":{"line":6,"column":1}},"key":"expCJZqcq5"}],"key":"CnrxJZMK7D"}],"key":"UK5YqaBcd2"}],"key":"vmJrdrTePv"}],"key":"JIvjTuI6R3"}],"key":"TlF3wW18rS"}],"key":"CSWCzvKWAb"},"references":{"cite":{"order":[],"data":{}}}}