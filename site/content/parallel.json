{"version":2,"kind":"Notebook","sha256":"075f1cbebfad2e56fce2ead9133711f9c16c6f97ec6126406744b932f72d9463","slug":"parallel","location":"/9.parallel.ipynb","dependencies":[],"frontmatter":{"title":"并行","content_includes_title":false,"kernelspec":{"name":"py313","display_name":"Python (py3.13)","language":"python"},"github":"https://github.com/luochang212/langgraph-tutorial","keywords":["LangGraph","Langchain"],"source_url":"https://github.com/luochang212/langgraph-tutorial/blob/main/9.parallel.ipynb","edit_url":"https://github.com/luochang212/langgraph-tutorial/edit/main/9.parallel.ipynb","exports":[{"format":"ipynb","filename":"9.parallel.ipynb","url":"/9.parallel-0715c34fc9a3841a9a76f9a2ca3137b9.ipynb"}]},"widgets":{},"mdast":{"type":"root","children":[{"type":"block","kind":"notebook-content","children":[{"type":"paragraph","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"本节验证一件事：让我们看看使用 ","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"nUVQHJpRYF"},{"type":"inlineCode","value":"StateGraph","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"YXK277wXyC"},{"type":"text","value":" 创建的可并行节点是否真的在并行，让我们打印时间看看。","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"S0XNgu6zE5"}],"key":"ollNtCrw6H"}],"key":"qae3JlZ0km"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"import time\nfrom datetime import datetime\nfrom langgraph.graph import StateGraph, MessagesState, START, END\nfrom langchain_core.messages import HumanMessage\nfrom langchain_core.runnables import RunnableConfig","key":"l2ysF18lZF"},{"type":"output","id":"vjpZ2474_kbH74ZEdyxVC","data":[],"key":"viAdewwFn4"}],"key":"pfNwnAaJo2"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"# 创建虚拟并行节点1\ndef parallel_node1(state: MessagesState, config: RunnableConfig):\n    start_time = datetime.now()\n    print(f\"[parallel_node1] 进入函数时间: {start_time.strftime('%Y-%m-%d %H:%M:%S.%f')[:-3]}\")\n\n    # 使用 sleep 模拟占用时间\n    time.sleep(5)\n\n    end_time = datetime.now()\n    print(f\"[parallel_node1] 退出函数时间: {end_time.strftime('%Y-%m-%d %H:%M:%S.%f')[:-3]}\")\n\n    return {'messages': [HumanMessage(\n        content=f'虚拟节点1运行了{round((end_time - start_time).total_seconds(), 3)}秒'\n    )]}\n\n# 创建虚拟并行节点2\ndef parallel_node2(state: MessagesState, config: RunnableConfig):\n    start_time = datetime.now()\n    print(f\"[parallel_node2] 进入函数时间: {start_time.strftime('%Y-%m-%d %H:%M:%S.%f')[:-3]}\")\n\n    # 使用 sleep 模拟占用时间\n    time.sleep(10)\n\n    end_time = datetime.now()\n    print(f\"[parallel_node2] 退出函数时间: {end_time.strftime('%Y-%m-%d %H:%M:%S.%f')[:-3]}\")\n\n    return {'messages': [HumanMessage(\n        content=f'虚拟节点2运行了{round((end_time - start_time).total_seconds(), 3)}秒'\n    )]}\n\n# 创建图\nbuilder = StateGraph(MessagesState)\n\n# 添加节点\nbuilder.add_node('parallel_node1', parallel_node1)\nbuilder.add_node('parallel_node2', parallel_node2)\n\n# 添加边\nbuilder.add_edge(START, 'parallel_node1')\nbuilder.add_edge(START, 'parallel_node2')\nbuilder.add_edge('parallel_node1', END)\nbuilder.add_edge('parallel_node2', END)\n\n# 编译图\nmy_graph = builder.compile(name='my-graph')\nmy_graph","key":"hwr794gYFw"},{"type":"output","id":"hDUvEprgpdjqpYdPVET41","data":[{"output_type":"execute_result","execution_count":2,"metadata":{},"data":{"image/png":{"content_type":"image/png","hash":"ef261737bfdcfab0a6eb505be504751b","path":"/ef261737bfdcfab0a6eb505be504751b.png"},"text/plain":{"content":"<langgraph.graph.state.CompiledStateGraph object at 0x10bdfe270>","content_type":"text/plain"}}}],"key":"keT8vP7ACe"}],"key":"MfcQnKSnyE"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"# 调用图\nresponse = my_graph.invoke({'messages': [HumanMessage(content='执行 parallel_node1 和 parallel_node2')]})\n\nfor message in response['messages']:\n    message.pretty_print()","key":"GziIvdoRwE"},{"type":"output","id":"1bC7RgFa1AZ5xNlBB_H-l","data":[{"name":"stdout","output_type":"stream","text":"[parallel_node1] 进入函数时间: 2025-11-09 19:43:06.557\n[parallel_node2] 进入函数时间: 2025-11-09 19:43:06.557\n[parallel_node1] 退出函数时间: 2025-11-09 19:43:11.562\n[parallel_node2] 退出函数时间: 2025-11-09 19:43:16.562\n================================\u001b[1m Human Message \u001b[0m=================================\n\n执行 parallel_node1 和 parallel_node2\n================================\u001b[1m Human Message \u001b[0m=================================\n\n虚拟节点1运行了5.005秒\n================================\u001b[1m Human Message \u001b[0m=================================\n\n虚拟节点2运行了10.005秒\n"}],"key":"bNx452a7OZ"}],"key":"LAInUQifgP"}],"key":"erZ9v2YmFG"},"references":{"cite":{"order":[],"data":{}}}}