<!DOCTYPE html>
<html lang="en-us">
    
    


    <head>
    <link href="https://gmpg.org/xfn/11" rel="profile">
    <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta http-equiv="Cache-Control" content="public" />
<!-- Enable responsiveness on mobile devices -->
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">
<meta name="generator" content="Hugo 0.55.6" />

    
    
    

<title>Python 工程化实践 • Chang Luo</title>


<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="Python 工程化实践"/>
<meta name="twitter:description" content="学 Python 不应仅限于学习程序设计，在工程实践中同样存在大量知识，比如虚拟环境的搭建、编码风格的养成以及如何编写单测等等。本文致力于介绍 Python 走向工程化所需的前置知识。"/>

<meta property="og:title" content="Python 工程化实践" />
<meta property="og:description" content="学 Python 不应仅限于学习程序设计，在工程实践中同样存在大量知识，比如虚拟环境的搭建、编码风格的养成以及如何编写单测等等。本文致力于介绍 Python 走向工程化所需的前置知识。" />
<meta property="og:type" content="article" />
<meta property="og:url" content="http://luochang212.github.io/posts/python_practice/" />
<meta property="article:published_time" content="2020-06-14T00:00:00&#43;00:00"/>
<meta property="article:modified_time" content="2020-06-14T00:00:00&#43;00:00"/><meta property="og:site_name" content="Title" />


    


<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/github.min.css">








<link rel="stylesheet" href="/scss/hyde-hyde.6a83d62c39a364f036df4db1ecd564645635d6c7fc182425cb501218fec485f5.css" integrity="sha256-aoPWLDmjZPA2302x7NVkZFY11sf8GCQly1ASGP7EhfU=">


<link rel="stylesheet" href="/scss/print.2744dcbf8a0b2e74f8a50e4b34e5f441be7cf93cc7de27029121c6a09f9e77bc.css" integrity="sha256-J0Tcv4oLLnT4pQ5LNOX0Qb58&#43;TzH3icCkSHGoJ&#43;ed7w=" media="print">




<link rel="stylesheet" href="/scss/hugo-toc.8549a64d301421b4256ea9a0d5ca8b99178799f569d5d2daeb95f24cef3ce6b7.css" integrity="sha256-hUmmTTAUIbQlbqmg1cqLmReHmfVp1dLa65XyTO885rc=">



    <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
    <!--[if lt IE 9]>
    <script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
    <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
    <!-- Icons -->
    <link rel="apple-touch-icon-precomposed" sizes="144x144" href="/apple-touch-icon-144-precomposed.png">
    <link rel="shortcut icon" href="/favicon.png">
    
</head>


    <body class=" ">
    <head>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <script src="https://upcdn.b0.upaiyun.com/libs/jquery/jquery-1.9.0.min.js"></script>

  <style>
    body {
      transition: background-color .5s;
    }

    #overlay {
      position: fixed;
      display: none;
      width: calc(100vw - 580px);
      height: 100%;
      top: 0;
      left: 0;
       
      z-index: 2;
      cursor: pointer;
    }

    .sidenav {
      height: 100%;
      width: 0;
      position: fixed;
      z-index: 1000;
      top: 0;
      right: 0;
      background-color: #FFF;
       
      overflow-x: hidden;
      transition: 0.5s;
       
       
    }

    #main {
      transition: margin-left .5s;
       
      padding: 16px;
      position: absolute;
      top: 0;
      right: 0;
      bottom: 0;
      left: 0;
      overflow: hidden;
    }

     
    .tab {
      overflow: hidden;
      border: 1px solid #ccc;
      background-color: #f1f1f1;
    }

     
    .tab button {
      background-color: inherit;
      float: left;
      border: none;
      outline: none;
      cursor: pointer;
      padding: 14px 16px;
      transition: 0.3s;
      font-size: 17px;
    }

     
    .tab button:hover {
      background-color: #ddd;
    }

     
    .tab button.active {
      background-color: #ccc;
    }

     
    .tabcontent {
      display: none;
      padding: 12px 12px;
      margin: 0;
      border: 1px solid #ccc;
      border-top: none;
    }

    .dropbtn {
      background-color: #3498DB;
      color: white;
      padding: 16px;
      font-size: 16px;
      border: none;
    }

    .dropup {
      position: relative;
      display: inline-block;
    }

    .dropup-content {
      display: none;
      position: absolute;
      background-color: #f1f1f1;
      min-width: 160px;
      bottom: 50px;
      z-index: 1;
    }

    .dropup-content a {
      color: black;
      padding: 12px 16px;
      text-decoration: none;
      display: block;
    }

    .dropup-content a:hover {
      background-color: #ccc
    }

    .dropup:hover .dropup-content {
      display: block;
    }

    .dropup:hover .dropbtn {
      background-color: #2980B9;
    }

    #video2,
    #video3 {
      display: none;
    }
  </style>

</head>

<body>

  
  <div class="sidebar">
    <div class="container ">
      <div class="sidebar-about">
        <span class="site__title">
          <a href="http://luochang212.github.io">Chang Luo</a>
        </span>
        
        
        
        <div class="author-image">
          <a href="#" class="load-iframe" onclick="openNav()"><img src="http://luochang212.github.io/images/profile.png" id="author-iamge"
              alt="Author Image" class="img--circle img--headshot element--center"></a>
        </div>
        
        <p class="site__description">
          
        </p>
      </div>
      <div class="collapsible-menu">
        <input type="checkbox" id="menuToggle">
        <label for="menuToggle">Chang Luo</label>
        <div class="menu-content">
          <div>
	<ul class="sidebar-nav">
		 
		 
			 
				<li>
					<a href="/">
						<span>Posts</span>
					</a>
				</li>
			 
		 
			 
				<li>
					<a href="/portfolio/">
						<span>Projects</span>
					</a>
				</li>
			 
		 
			 
				<li>
					<a href="/about/">
						<span>About Me</span>
					</a>
				</li>
			 
		
		</li>
	</ul>
</div>

          <section class="social">
	
	<a href="https://twitter.com/MinosPalace" rel="me"><i class="fab fa-twitter fa-lg" aria-hidden="true"></i></a>
	
	
	
	<a href="https://instagram.com/icstocs" rel="me"><i class="fab fa-instagram fa-lg" aria-hidden="true"></i></a>
	
	
	<a href="https://github.com/luochang212" rel="me"><i class="fab fa-github fa-lg" aria-hidden="true"></i></a>
	
	
	
	
	
	
	
	
	
	
	
	<a href="https://linkedin.com/in/bupt-luochang" rel="me"><i class="fab fa-linkedin fa-lg" aria-hidden="true"></i></a>
	
	
	
	
	
	
	
	
</section>

        </div>
      </div>
      
<div class="copyright">
  &copy; 2020 Chang Luo
  
</div>



    </div>
  </div>

  
  

  <div id="overlay" onclick="off()"></div>

  <div id="mySidenav" class="sidenav">

    <div id="main">
      <div class="tab">
        <button id="default-tab" class="tablinks" onclick="openItem(event, 'Resources')">Resources</button>
        <button class="tablinks" onclick="openItem(event, 'netease-player')">Music</button>
        <button class="tablinks" onclick="openItem(event, 'Video-player')">Video</button>
        <button class="tablinks" onclick="openItem(event, 'gallery')">Gallery</button>
        <button class="tablinks" onclick="openItem(event, 'gadget')">Gadget</button>
      </div>

      <div id="Resources" class="tabcontent">
        <iframe src="about:blank" data-src="/resources/" frameborder="0" height="560" width="100%" marginheight="0"
          marginwidth="0" scrolling="yes"></iframe>
      </div>

      <div id="netease-player" class="tabcontent">
        <iframe src="about:blank" data-src="//music.163.com/outchain/player?type=0&id=2250585392&auto=0&height=430"
          frameborder="no" border="0" marginwidth="0" marginheight="0" width=100% height=450></iframe>
      </div>

      <div id="Video-player" class="tabcontent">

        <div id="video1">
          <iframe src="about:blank" data-src="//player.bilibili.com/player.html?aid=455023331&bvid=BV1X541167RE&cid=170542054&page=1&high_quality=1&danmaku=0"
            style="width:100%; height:460px" scrolling="no" border="0" frameborder="no" framespacing="0"
            allowfullscreen="true"></iframe>
        </div>
        <div id="video2">
          <iframe src="about:blank" data-src="//player.bilibili.com/player.html?aid=65042716&bvid=BV1M4411r7yu&cid=112895137&page=1&high_quality=1&high_quality=1&danmaku=0"
            style="width:100%; height:460px" scrolling="no" border="0" frameborder="no" framespacing="0"
            allowfullscreen="true"></iframe>
        </div>
        <div id="video3">
          <iframe src="about:blank" data-src="//player.bilibili.com/player.html?aid=20535616&bvid=BV1zW411W75L&cid=33582726&page=1//player.bilibili.com/player.html?aid=15159845&cid=24679968&page=1&high_quality=1&danmaku=0"
            style="width:100%; height:460px" scrolling="no" border="0" frameborder="no" framespacing="0"
            allowfullscreen="true"></iframe>
        </div>

        

        

        <br>
        <div class="dropup">
          <button class="dropbtn">更多视频</button>
          <div class="dropup-content">
            <a onclick="link1()">1</a>
            <a onclick="link2()">2</a>
            <a onclick="link3()">3</a>
          </div>
        </div>
      </div>

      <div id="gallery" class="tabcontent">
        <iframe src="about:blank" data-src="/gadget/gallery/#two" frameborder="0" height="560" width="100%"
          scrolling="yes"></iframe>
      </div>

      <div id="gadget" class="tabcontent">
        <iframe src="about:blank" data-src="/gadget/" frameborder="0" height="560" width="100%"
          scrolling="yes"></iframe>
      </div>

    </div>
  </div>

  
  <script>
    'use strict'
    
    function openNav() {
      on();
      document.getElementById("mySidenav").style.width = "580px";
      document.body.style.backgroundColor = "rgba(0,0,0,0.5)";
    }

    function closeNav() {
      document.getElementById("mySidenav").style.width = "0";
      document.body.style.backgroundColor = "white";
    }

    function on() {
      document.getElementById("overlay").style.display = "block";
    }

    function off() {
      closeNav();
      document.getElementById("overlay").style.display = "none";
    }

    
    document.getElementById('default-tab').click();

    function openItem(evt, itemName) {
      var i, tabcontent, tablinks;
      tabcontent = document.getElementsByClassName("tabcontent");
      for (i = 0; i < tabcontent.length; i++) {
        tabcontent[i].style.display = "none";
      }
      tablinks = document.getElementsByClassName("tablinks");
      for (i = 0; i < tablinks.length; i++) {
        tablinks[i].className = tablinks[i].className.replace(" active", "");
      }
      document.getElementById(itemName).style.display = "block";
      evt.currentTarget.className += "active";
    }

    function link1() {
      document.getElementById("video1").style.display = "block";
      document.getElementById("video2").style.display = "none";
      document.getElementById("video3").style.display = "none";
    }

    function link2() {
      document.getElementById("video1").style.display = "none";
      document.getElementById("video2").style.display = "block";
      document.getElementById("video3").style.display = "none";
    }

    function link3() {
      document.getElementById("video1").style.display = "none";
      document.getElementById("video2").style.display = "none";
      document.getElementById("video3").style.display = "block";
    }

     
    var flag = 0;

     
    $(".load-iframe").click(function () {
      if (flag < 1) {
        $("iframe").each(function () {
          $(this).attr("src", $(this).data("src"));
        });
        flag = flag + 1;
      }
    });
  </script>

</body>



        <div class="content container">
            
    
<article>
  <header>
    <h1>Python 工程化实践</h1>
    
    
<div class="post__meta">
    
    
      <i class="fas fa-calendar-alt"></i> Jun 14, 2020
    
    
    
      
      
          in
          
          
              <a class="badge badge-category" href="/categories/development">DEVELOPMENT</a>
              •
          
              <a class="badge badge-category" href="/categories/python">PYTHON</a>
              
          
      
    
    
    
      
      
          <br/>
           <i class="fas fa-tags"></i>
          
          <a class="badge badge-tag" href="/tags/python">python</a>
           
      
          <a class="badge badge-tag" href="/tags/practice">practice</a>
          
      
    
    
    <br/>
    <i class="fas fa-clock"></i> 7 min read
</div>


  </header>
  
  
  
    <div class="toc-wrapper">
      <input type="checkbox" id="tocToggle">
      <label for="tocToggle">目录</label>
      
          <nav id="TableOfContents">
<ul>
<li>
<ul>
<li><a href="#部署环境">部署环境</a>
<ul>
<li><a href="#1-anaconda">1. Anaconda</a>
<ul>
<li><a href="#①-部署全局环境">① 部署全局环境</a></li>
<li><a href="#②-部署局部环境">② 部署局部环境</a></li>
</ul></li>
<li><a href="#2-virtualenv">2. Virtualenv</a></li>
<li><a href="#3-docker">3. Docker</a></li>
</ul></li>
<li><a href="#代码风格">代码风格</a>
<ul>
<li><a href="#1-docstrings">1. Docstrings</a></li>
<li><a href="#2-none-的判断">2. None 的判断</a></li>
<li><a href="#3-命名">3. 命名</a></li>
</ul></li>
<li><a href="#单元测试">单元测试</a>
<ul>
<li><a href="#unittest">unittest</a></li>
</ul></li>
<li><a href="#从命令行运行-python">从命令行运行 Python</a>
<ul>
<li><a href="#1-命令行选项">1. 命令行选项</a></li>
<li><a href="#2-从标准输入获取文本">2. 从标准输入获取文本</a>
<ul>
<li><a href="#①-使用-echo-从命令行获取输入">① 使用 <code>echo</code> 从命令行获取输入</a></li>
<li><a href="#②-使用-cat-从指定文件获取输入">② 使用 <code>cat</code> 从指定文件获取输入</a></li>
<li><a href="#③-从另一个-python-文件输出流中获取输入">③ 从另一个 Python 文件输出流中获取输入</a></li>
</ul></li>
<li><a href="#3-从命令行读入参数">3. 从命令行读入参数</a></li>
<li><a href="#4-标准错误输出">4. 标准错误输出</a>
<ul>
<li><a href="#①-将标准错误打印到命令行">① 将标准错误打印到命令行</a></li>
<li><a href="#②-将标准错误打印到日志">② 将标准错误打印到日志</a></li>
</ul></li>
</ul></li>
</ul></li>
</ul>
</nav>
      
    </div>
  
  
  <div class="post">
    

<blockquote>
<p>学 Python 不应仅限于学习程序设计，在工程实践中同样存在大量知识，比如虚拟环境的搭建、编码风格的养成以及如何编写单测等等。本文致力于介绍 Python 走向工程化所需的前置知识。</p>
</blockquote>

<p><font color="red">⚠️</font> 注意：以下教程适用于 MacOS。</p>

<h2 id="部署环境">部署环境</h2>

<h3 id="1-anaconda">1. Anaconda</h3>

<p>Anaconda 是一个包管理器，它能让你方便的管理 Python 版本和包版本。并且， Anaconda 聚合了 Jupyter notebook，使其大受数据科学家和人工智能工程师的欢迎。下面我们来介绍如何用 Anaconda 管理我们的 Python 环境。</p>

<p>如果你还没有 Anaconda，安装一个：</p>

<ul>
<li>海外用户直接访问 <a href="https://www.anaconda.com/products/individual">Anaconda 官网</a> 下载即可</li>
<li>国内用户无法访问Anaconda 官网(被墙)，建议选择<a href="https://mirrors.tuna.tsinghua.edu.cn/anaconda/">清华镜像</a>替代。</li>
</ul>

<p>安装完以后，在命令行界面输入 <code>conda</code>，会打印一个帮助文档。</p>

<p><img src="/img/conda-command.png" alt="" /></p>

<p>帮助文档大概是说 conda 有哪些常用命令，比如下面这些：</p>

<pre><code class="language-shell">$ conda help  # 打印帮助文档
$ conda info  # 查看conda信息，包括当前在哪个环境，环境路径，Python版本等信息
$ conda list  # 列出conda下安装了哪些包
$ conda install [package_name]  # 在conda环境中安装某个包
$ conda update [package_name]  # 升级conda环境中的某个包
</code></pre>

<blockquote>
<p><strong>Note</strong>：后文仅专注介绍虚拟环境相关内容，更多内容请在 <a href="https://docs.conda.io/projects/conda/en/latest/user-guide/tasks/manage-environments.html">Anaconda 官方文档</a> 中查看。</p>
</blockquote>

<p>Python 环境分为本地环境(lcoal env) 和全局环境 (global env) 。为一个项目配置环境，应该配置本地环境；为本机所有项目配置环境，则应该配置全局环境。</p>

<h4 id="①-部署全局环境">① 部署全局环境</h4>

<p>📖 新建环境</p>

<pre><code class="language-shell">$ conda create --name myenv
</code></pre>

<p>上述命令新建一个名为 <code>myenv</code> 的全局环境.</p>

<pre><code class="language-shell">$ conda create -n myenv python=2.7
</code></pre>

<p>上述命令用于指定新建环境的 Python 版本，本例指定 Python 版本为 2.7。</p>

<pre><code class="language-shell">$ conda create -n myenv python=2.7 [package1] [package2] [package3]  ...
</code></pre>

<p>上述命令指定新建环境下初始安装包。</p>

<p>👀 查看环境</p>

<pre><code class="language-shell">$ conda info --envs
</code></pre>

<p>上述命令打印所有 Python 环境，包括全局环境和局部环境，在当前环境前会有一个 <code>*</code> 号。</p>

<p>🏀 激活环境</p>

<pre><code class="language-shell">$ conda activate myenv
</code></pre>

<p>环境需要激活才能使用。上述命令将名为 <code>myenv</code> 的 conda 环境激活。</p>

<p>⚽️ 退出环境</p>

<pre><code class="language-shell">$ conda deactivate
</code></pre>

<p>上述命令用于退出当前 conda 环境。在非 base 环境里，会退出到 base 环境；而在 base 环境里，则会退出到系统环境。</p>

<blockquote>
<p><strong>Note</strong>: 退到系统环境以后，在命令行输入 <code>which python</code> 会打印系统 Python 的路径。再次进入 conda 环境以后，输入 <code>which python</code> 则会打印 conda 下的 Python 路径。</p>

<p>鉴于今年（2020年）的 MacOS 系统依旧默认安装 Python2.7，因此建议把 conda 作为默认运行环境以享受 Python3 的便利！</p>
</blockquote>

<p>🚮 移除环境</p>

<pre><code class="language-shell">$ conda env remove --name myenv
</code></pre>

<p>上述命令移除名为 <code>myenv</code> 的全局环境。</p>

<h4 id="②-部署局部环境">② 部署局部环境</h4>

<p>如果我们需要为某个项目配置特定的 Python 版本或包版本，就需要搭建局部环境(local environment)。</p>

<p>📖 新建环境</p>

<pre><code class="language-shell">$ conda create --prefix ./envs python=2.7
</code></pre>

<p>上述命令在当前工作目录下，新建了一个名为 <code>envs</code> 的子目录。并在该子目录下新建了一个虚拟环境，并指定该环境的 Python 版本为 2.7。</p>

<p>🏀 激活环境</p>

<pre><code class="language-shell">$ conda activate ./envs
</code></pre>

<p>⚽️ 退出环境</p>

<pre><code class="language-shell">$ conda deactivate
</code></pre>

<p>⏬ 安装依赖</p>

<pre><code class="language-shell">$ conda install [package_name]
</code></pre>

<p>上述命令用于为此环境安装各种包。</p>

<pre><code class="language-shell">$ pip install [package_name]
</code></pre>

<p>有些包 conda 安装不了，可以<a href="https://docs.conda.io/projects/conda/en/latest/user-guide/tasks/manage-environments.html#using-pip-in-an-environment">使用 pip 安装</a>。</p>

<blockquote>
<p><strong>Note</strong>: conda 集成了 pip，所以在 conda 环境下也可以使用 pip 命令。在 conda 环境下，试试 <code>pip list</code> 吧～</p>
</blockquote>

<p>🚮 移除环境</p>

<pre><code class="language-shell">$ rm -rf ./envs
</code></pre>

<p>移除环境只需要删除对应的安装目录就可以了。注意，<code>rm -rf</code> 是一个极其危险的命令，使用时请务必小心。</p>

<h3 id="2-virtualenv">2. Virtualenv</h3>

<blockquote>
<p><strong>Note</strong>: Virtualenv 的好处在于体积小，适合开发机之类的环境。如果我们在笔记本电脑上做开发，还是用 conda 部署环境更方便～</p>
</blockquote>

<p>Virtualenv 用于为 Python 项目创建独立的运行环境。</p>

<p>作为一门动态语言，Python 程序能否正确运行和环境配置密切相关。当我们下载好一个 Python 项目代码，通常需要先配置环境，然后才能运行。为了防止这个外来的 Python 项目污染我们的全局环境(global environment)，我们应该为它配置独立的运行环境。这时 Virtualenv 就派上用场了。</p>

<p>在 Virtualenv 创建的虚拟环境中，我们可以指定特定的包版本甚至Python版本，而不影响全局环境。但需要注意的是，因为 Virtualenv 依赖于全局环境，因此如果你更新了 Python 全局环境，有可能对 Virtualenv 造成影响。</p>

<p>更多细节参见 <a href="https://docs.python.org/3/library/venv.html">Virtualenv 文档</a>。</p>

<!-- > 注：以下教程适用于 MacOS。 -->

<p>如果你还没有 Virtualenv，打开命令行窗口，下载一个。</p>

<pre><code class="language-shell">$ pip install virtualenv
</code></pre>

<p>📖 新建环境</p>

<p>安装好之后，如果你想在当前目录创建一个虚拟环境，只需要一行代码。</p>

<pre><code class="language-shell">$ virtualenv my_project  # my_project 可替换为你项目的名称
</code></pre>

<blockquote>
<p><strong>Note</strong>: 如果需要安装特定版本的 Python，可使用 <code>-p</code> 选项指定 Python 版本。</p>

<pre><code class="language-shell">$ virtualenv -p /usr/bin/python2.6 my_project
</code></pre>
</blockquote>

<p>🏀 激活环境</p>

<p>用 <code>ls</code> 命令检查，你可以发现当前目录下创建了一个名为 <code>my_project</code> 的文件夹。但虚拟环境仅仅是被创建，要激活该环境，请使用如下命令：</p>

<pre><code class="language-shell">$ source my_project/bin/activate
</code></pre>

<p>激活完以后，使用以下命令可看当前的 Python 路径：</p>

<pre><code class="language-shell">$ which Python
</code></pre>

<p>使用以下命令可查看当前的 pip 路径。如果你的虚拟环境创建成功了，那么路径应当会变更到虚拟环境目录下。</p>

<pre><code class="language-shell">$ which pip
</code></pre>

<p>使用命令</p>

<pre><code class="language-shell">$ pip list
</code></pre>

<p>可查看当前 pip 安装的所有包。你会发现当前环境下仅仅只剩少数几个包，因为这是一个全新的环境。现在你可以在这个新环境下配置项目所需的包版本了！</p>

<p>在为你的项目安装完一系列库依赖之后，你可能想记录当前的环境配置，使用 pip 的 freeze 命令可以帮你做到这一点。</p>

<pre><code class="language-shell">$ pip freeze --local &gt; requirements.txt
</code></pre>

<p>这将把当前已安装的包和对应包版本记录在当前目录下的 <code>requirements.txt</code> 文件中。</p>

<blockquote>
<p><strong>Note</strong>: 在将来构建新环境时，只要使用如下命令，就可以移植该 txt 文件指定的环境配置。</p>

<pre><code>$ pip install -r requirements.txt
</code></pre>
</blockquote>

<p>⚽️ 退出环境</p>

<p>最后，当你想退出虚拟环境，回到全局环境时，可使用如下命令：</p>

<pre><code class="language-shell">$ deactivate
</code></pre>

<p>通过 <code>which Python</code> 或者 <code>which pip</code> 检查一下是否回到了全局环境吧～</p>

<p>🚮 移除环境</p>

<p>在 <code>my_project</code> 所在目录下执行：</p>

<pre><code class="language-shell">$ rm -rf my_project
</code></pre>

<p>请谨慎使用 <code>rm -rf</code>。</p>

<h3 id="3-docker">3. Docker</h3>

<p><a href="https://www.docker.com/">Docker</a> 是什么？</p>

<p>Docker 是一项虚拟化技术，它将软件和配置文件、依赖库封装在一起，放到一个操作系统级别的虚拟化环境中。这个环境我们称作容器 (container)。容器和容器之前是相互隔离的，但是也能通过优良定义的接口进行交互。因为容器运行在一个单独的操作系统内核上，因此它占用的资源比虚拟机更少。</p>

<blockquote>
<p>原文：<strong>Docker</strong> is a set of platform as a service (PaaS) products that use OS-level virtualization to deliver software in packages called containers. Containers are isolated from one another and bundle their own software, libraries and configuration files; they can communicate with each other through well-defined channels. All containers are run by a single operating system kernel and therefore use fewer resources than virtual machines. &ndash; from wikipedia</p>
</blockquote>

<p>✨ 下面我们来介绍如何使用 Docker。</p>

<p>1.首先去官网下载 <a href="https://www.docker.com/products/docker-desktop">Docker Desktop</a>。</p>

<p>2.安装 Docker，装完后执行 <code>docker -v</code> 以检查安装是否成功。</p>

<p>3.新建一个文件夹，然后打开它 <code>mkdir myDocker; cd myDocker</code>。</p>

<p>4.随便在里面建点啥，比如计算数列元素的平均值：</p>

<pre><code># calc.py
# pip install numpy

import numpy as np

lst = np.array([2 ** i for i in range(5)])
print('list:', *lst)
print('mean:', np.mean(lst))
</code></pre>

<p>5.记录当前的依赖库及其版本，输出到 <code>requirements.txt</code> 文件上。</p>

<pre><code class="language-shell">pip freeze &gt; requirements.txt
</code></pre>

<p>6.然后，我们新建一个 Dockerfile，它相当于 Docker 的配置文件。</p>

<pre><code># Dockerfile

# Specify Python version
FROM python:3.8.5-buster

# Make a directory for our application
WORKDIR /app

# Install Dependences
COPY requirements.txt .
RUN pip install -r requirements.txt

# Copy our source code
COPY calc.py .

# Run the application
CMD [&quot;python&quot;, &quot;calc.py&quot;]
</code></pre>

<p>PS: Python 版本名可以在 <a href="https://hub.docker.com/_/python">Docker Hub</a> 中找。</p>

<p>7.运行 Dokcer 以创建容器。</p>

<pre><code class="language-shell">docker build -t dockerproject .
</code></pre>

<p>8.运行容器中的应用。</p>

<pre><code class="language-shell">docker run dockerproject
</code></pre>

<p>如果显示如下结果，说明容器构建成功！</p>

<p><img src="/img/python-practice-1.png" alt="" /></p>

<blockquote>
<p>视频教程：</p>

<ol>
<li>基于node.js：<a href="https://youtu.be/8XrDSNnesEQ">别问，问就先干</a></li>
<li>基于Flask：<a href="https://youtu.be/gHaFqYRJ_aw">How To Containerize Your Python Application using Docker</a> (本章基于此教程改编)</li>
</ol>

<p>文字教程：</p>

<ol>
<li><a href="https://www.runoob.com/docker/docker-tutorial.html">菜鸟教程</a></li>
<li><a href="https://docs.docker.com/get-started/">Docker Documentation</a></li>
</ol>
</blockquote>

<p><br></p>

<h2 id="代码风格">代码风格</h2>

<blockquote>
<p>引言：为什么工程化 Python 需要重视代码风格？</p>

<ol>
<li>按某种约定风格写代码，可以让团队项目的风格更统一，有利于团队成员间交接工作。</li>
<li>工程项目通常代码量较大。随着代码量的增加，debug 变得愈发困难。按约定好的风格写代码，能有效预防代码发生未预期的错误。</li>
</ol>
</blockquote>

<p>建议通过 <a href="http://google.github.io/styleguide/pyguide.html"><em>Google Python Style Guide</em></a> 学习代码风格，该指南非常中肯地提出了每项建议的优缺点以及例外的情况。</p>

<p>下面列几条我认为重要的代码风格建议：</p>

<h3 id="1-docstrings">1. Docstrings</h3>

<p>docstring 是 Python 为模块、类、函数书写帮助文档的一种方法。按约定，写在模块、类、函数之下的第一条声明就是 docstring.</p>

<pre><code class="language-python">def foo():
    &quot;&quot;&quot;docstring here.&quot;&quot;&quot;
    pass
</code></pre>

<p>可以通过对象的<code>__doc__</code>成员查看该对象的 docstring。假如你已经为函数<code>foo()</code>写好了 docstring，那么你可以使用如下命令查看它。</p>

<pre><code class="language-python">print(foo.__doc__)
</code></pre>

<p>关于书写docstring的具体规范，请参见 <a href="http://google.github.io/styleguide/pyguide.html">Google Python Style Guide</a>，这里就不过分拾人牙慧了。</p>

<h3 id="2-none-的判断">2. None 的判断</h3>

<p>判断一个变量是否为空，请使用 <code>if foo is None</code> (或者 <code>if foo is not None</code> ). 避免使用 <code>==</code> 判断。</p>

<p>为什么这里要用 <code>is</code> 呢？下面是 <em>Fluent Python</em> 一书中的解释：</p>

<p><details>
<summary><font color='#0284c5'>已折叠，点击展开</font></summary></p>

<blockquote>
<p>The <code>==</code> operator compares the values of objects (the data they hold), while is compares their identities.</p>

<p>We often care about values and not identities, so == appears more frequently than is in Python code.</p>

<p>However, if you are comparing a variable to a singleton, then it makes sense to use is. By far, the most common case is checking whether a variable is bound to None. This is the recommended way to do it:</p>

<pre><code class="language-python">x is None
</code></pre>

<p>And the proper way to write its negation is:</p>

<pre><code class="language-python">x is not None
</code></pre>

<p>The <code>is</code> operator is faster than <code>==</code>, because it cannot be overloaded, so Python does not have to find and invoke special methods to evaluate it, and computing is as simple as comparing two integer IDs. In contrast, <code>a == b</code> is syntactic sugar for <code>a.__eq__(b)</code>. The <code>__eq__</code> method inherited from object compares object IDs, so it produces the same result as is. But most built-in types override <code>__eq__</code> with more meaningful implementations that actually take into account the values of the object attributes. Equality may involve a lot of processing —- for example, when comparing large collections or deeply nested structures.</p>

<p>摘自 <em>Fluent Python</em> CHAPTER 8</p>
</blockquote>

<p></details></p>

<p>总结来说就是，虽然 <code>==</code> 和 <code>is</code> 的运算结果相同，但 <code>==</code> 其实是 <code>__eq__</code> 的语法糖，而 <code>__eq__</code> 在实际调用中经常被重载，导致程序进入一系列繁琐的步骤中。而 <code>is</code> 则直接比较两个对象的整数ID得出结果，所以比 <code>==</code> 效率更高。</p>

<h3 id="3-命名">3. 命名</h3>

<!-- # 这里还有东西要写 -->

<p>命名规范见下表：</p>

<table>
<thead>
<tr>
<th>Type</th>
<th>Public</th>
<th>Internal</th>
</tr>
</thead>

<tbody>
<tr>
<td>Packages</td>
<td>lower_with_under</td>
<td></td>
</tr>

<tr>
<td>Modules</td>
<td>lower_with_under</td>
<td>_lower_with_under</td>
</tr>

<tr>
<td>Classes</td>
<td>CapWords</td>
<td>_CapWords</td>
</tr>

<tr>
<td>Exceptions</td>
<td>CapWords</td>
<td></td>
</tr>

<tr>
<td>Functions</td>
<td>lower_with_under()</td>
<td>_lower_with_under()</td>
</tr>

<tr>
<td>Global/Class Constants</td>
<td>CAPS_WITH_UNDER</td>
<td>_CAPS_WITH_UNDER</td>
</tr>

<tr>
<td>Global/Class Variables</td>
<td>lower_with_under</td>
<td>_lower_with_under</td>
</tr>

<tr>
<td>Instance Variables</td>
<td>lower_with_under</td>
<td>_lower_with_under (protected)</td>
</tr>

<tr>
<td>Method Names</td>
<td>lower_with_under()</td>
<td>_lower_with_under() (protected)</td>
</tr>

<tr>
<td>Function/Method Parameters</td>
<td>lower_with_under</td>
<td></td>
</tr>

<tr>
<td>Local Variables</td>
<td>lower_with_under</td>
<td></td>
</tr>
</tbody>
</table>

<p>摘自 Google Python Style Guide</p>

<p><br></p>

<h2 id="单元测试">单元测试</h2>

<blockquote>
<p>关于 &ldquo;The best way of unit test&rdquo;，大家有不同的意见，有人觉得 nose 好用，有人觉得原生的 unittest 好用。但是我有不同的见解，个人觉得 Jupyter notebook 才是最好用的单测工具。<img src="/img/quyin/huaji.png" class="my-emoji" style = "height: 32px;"></p>
</blockquote>

<p>GitHub项目地址：<a href="https://github.com/luochang212/python-tips/tree/master/test" target="_blank">python-tips/test</a></p>

<p>当然言归正传，我们还是得正经地学习一下单测的。单测可以确保每个函数每个模块都按照我们预期的方式运行。如果你不是在写完代码以后，才写单测代码，而是一边开发一边测试，那么你其实遵循了<strong>测试驱动开发</strong>(Test-Driven Development)的开发方式。这种开发方式的好处是，在开发的全生命周期内，我们都能确保代码正确运行。</p>

<h3 id="unittest">unittest</h3>

<p>unittest 是 Python 原生支持(natively supported)的单元测试库。在使用这个库的时候，我们按照模版写就好了。模版可以参考 <a href="https://docs.python.org/3/library/unittest.html">unittest 文档</a> 中的 basic example 一节。</p>

<pre><code class="language-python"># file name: test_upper.py
import unittest

class TestStringMethods(unittest.TestCase):  # 继承 unittest.TestCase 是固定的写法

    def test_upper(self):  # 单测函数一般以test开头
        self.assertEqual('foo'.upper(), 'FOO')  # 使用assert断言判断测试结果是否符合预期

if __name__ == '__main__':
    unittest.main()  # 这个也是固定写法
</code></pre>

<p>在命令行运行 <code>python test_upper.py</code>，输出如下：</p>

<p><img src="/img/unittest-res.png" alt="" /></p>

<p>在上面这个例子中 <code>assertEqual(a, b)</code> 用于判断 <code>a</code> 和 <code>b</code> 是否相等。像这样的 assert 方法还有很多，下面是它们的用法：</p>

<table>
<thead>
<tr>
<th>Method</th>
<th>Checks that</th>
</tr>
</thead>

<tbody>
<tr>
<td>assertEqual(a, b)</td>
<td><code>a == b</code></td>
</tr>

<tr>
<td>assertNotEqual(a, b)</td>
<td><code>a != b</code></td>
</tr>

<tr>
<td>assertTrue(x)</td>
<td><code>bool(x) is True</code></td>
</tr>

<tr>
<td>assertFalse(x)</td>
<td><code>bool(x) is False</code></td>
</tr>

<tr>
<td>assertIs(a, b)</td>
<td><code>a is b</code></td>
</tr>

<tr>
<td>assertIsNot(a, b)</td>
<td><code>a is not b</code></td>
</tr>

<tr>
<td>assertIsNone(x)</td>
<td><code>x is None</code></td>
</tr>

<tr>
<td>assertIsNotNone(x)</td>
<td><code>x is not None</code></td>
</tr>

<tr>
<td>assertIn(a, b)</td>
<td><code>a in b</code></td>
</tr>

<tr>
<td>assertNotIn(a, b)</td>
<td><code>a not in b</code></td>
</tr>

<tr>
<td>assertIsInstance(a, b)</td>
<td><code>isinstance(a, b)</code></td>
</tr>

<tr>
<td>assertNotIsInstance(a, b)</td>
<td><code>not isinstance(a, b)</code></td>
</tr>
</tbody>
</table>

<blockquote>
<p><strong>Note</strong>: <code>setUp()</code> 方法运行在测试前，可将测试前需要运行的代码放在该函数内。<code>tearDown()</code> 方法运行在测试后，一般用于清理测试产生的变量。如果想要全面地了解单测，请阅读 <a href="https://docs.python.org/3/library/unittest.html">unittest 文档</a>，文档的作用是任何教程都无法替代的。</p>
</blockquote>

<p><br></p>

<h2 id="从命令行运行-python">从命令行运行 Python</h2>

<blockquote>
<p>运行 Python 的方法很多，常用的有 Pycharm, Jupyter notebook, VSCode 等。但是，公司的 Python 环境通常搭建在开发机上，而开发机安装的是 Linux 的各种发行版。这就需要我们<a href="https://wangdoc.com/bash/">熟悉 bash 编程</a>，以及 Python 的命令行选项。</p>
</blockquote>

<p>GitHub项目地址：<a href="https://github.com/luochang212/python-tips/tree/master/command_line" target="_blank">python-tips/command_line</a></p>

<h3 id="1-命令行选项">1. 命令行选项</h3>

<p>最常用的从命令行执行 Python 的方法是，在 Terminal 中进入脚本所在的工作路径下，执行：</p>

<pre><code class="language-shell">python srcipt.py  # script.py 可以换成你的 Python 文件
</code></pre>

<p>除了这种运行方法，Python 还提供 <code>-c</code> 和 <code>-m</code> 两个接口选项(interface options)。</p>

<p><strong><code>-c &lt;command&gt;</code></strong></p>

<p><code>-c</code> 选项后接 Python 代码，可在命令行直接执行。行前空格的规和脚本的规则相同。</p>

<pre><code class="language-shell"># 例一
python -c '
print(&quot;hello&quot;)
print(&quot;world&quot;)'
</code></pre>

<pre><code class="language-shell"># 例二
python -c '
for i in range(3):
    print(i)'
</code></pre>

<p><strong><code>-m &lt;module-name&gt;</code></strong></p>

<p><code>-m</code> 选项后接 Python 模块。该命令会在 <code>sys.path</code> 下搜索该模块，并将该模块作为 <code>__main__</code> 模块执行。</p>

<pre><code class="language-shell"># 如果你的工作目录下有一个 script.py 文件
python -m script  # 将 script.py 作为模块执行
</code></pre>

<blockquote>
<p><strong>Note</strong>: 更多内容请参考 <a href="https://docs.python.org/3/using/cmdline.html">Command line and environment</a>.</p>
</blockquote>

<h3 id="2-从标准输入获取文本">2. 从标准输入获取文本</h3>

<p>Python 可以从标准输入 <a href="https://docs.python.org/3/library/sys.html#sys.stdin">sys.stdin</a> 获取文本。</p>

<h4 id="①-使用-echo-从命令行获取输入">① 使用 <code>echo</code> 从命令行获取输入</h4>

<p>当前目录下新建 <code>read_text.py</code>。</p>

<pre><code class="language-python"># read_text.py
import sys

for line in sys.stdin:
    line = line.strip()
    print(line + '......ok')
</code></pre>

<p>然后我们在当前目录下执行：</p>

<pre><code class="language-shell">echo &quot;hello&quot; | python read_text.py
</code></pre>

<p>其输出是：</p>

<p><img src="/img/command-line-execute-1.png" alt="" /></p>

<p>这说明我们已经成功地从命令行读取了字符串 &ldquo;hello&rdquo;。</p>

<h4 id="②-使用-cat-从指定文件获取输入">② 使用 <code>cat</code> 从指定文件获取输入</h4>

<p>除了使用 <code>echo</code> 外，我们还可以使用 <code>cat</code> 将文件作为标准输入:</p>

<p>新建一个非空文件 info.txt，随便在里面写点什么。</p>

<pre><code class="language-shell">hello
are you ok
how are you
i fine, thx
that's great
</code></pre>

<p>执行：</p>

<pre><code class="language-shell">cat info.txt | python read_text.py
</code></pre>

<p>输出是：</p>

<p><img src="/img/command-line-execute-2.png" alt="" /></p>

<h4 id="③-从另一个-python-文件输出流中获取输入">③ 从另一个 Python 文件输出流中获取输入</h4>

<p>也可以从另一个 Python 文件的输出流中获取输入。</p>

<p>在当前目录下新建一个 <code>gen_text.py</code>。</p>

<pre><code class="language-python"># gen_text.py
import sys

for i in range(3):
    print(&quot; &quot;.join([&quot;This is line&quot;, str(i)]))
</code></pre>

<p>在命令行界面中，来到当前目录下执行：</p>

<pre><code class="language-shell">python gen_text.py | python read_text.py
</code></pre>

<p>获得的输出是：</p>

<p><img src="/img/command-line-execute-3.png" alt="" /></p>

<p>Windows 用户参见 <a href="https://stackoverflow.com/questions/1450393/how-do-you-read-from-stdin/1450396#1450396">How do you read from stdin?</a></p>

<h3 id="3-从命令行读入参数">3. 从命令行读入参数</h3>

<p>Python 可以通过 <a href="https://docs.python.org/3/library/sys.html#sys.argv">sys.argv</a> 从命令行读入参数。</p>

<p>在当前目录新建 <code>get_argv.py</code>。</p>

<pre><code class="language-python">import sys

print(sys.argv)
</code></pre>

<p>试试执行以下两个命令会输出什么吧～</p>

<pre><code>python get_argv.py  # 输出 ['get_argv.py']
python get_argv.py hi nihao  # 输出 ['get_argv.py', 'hi', 'nihao']
</code></pre>

<h3 id="4-标准错误输出">4. 标准错误输出</h3>

<p>Python 可以将标准错误 <a href="https://docs.python.org/3/library/sys.html#sys.stderr">sys.stderr</a> 打印到命令行。</p>

<h4 id="①-将标准错误打印到命令行">① 将标准错误打印到命令行</h4>

<pre><code class="language-python"># gen_error.py
import sys

print('NORMAL INFO')
print('ERROR INFO', file=sys.stderr)  # Python3
</code></pre>

<p>利用上述命令，我们可以将标准错误打印到命令行。但是，加了 <code>file</code> 参数的 <code>print</code> 函数和不加参数的似乎没有任何区别。其实有区别，请看下一个示例。</p>

<h4 id="②-将标准错误打印到日志">② 将标准错误打印到日志</h4>

<pre><code class="language-shell">python gen_error.py &gt;&gt; result.log 2&gt;&gt; error.log
</code></pre>

<p>利用上述命令，我们可以把正常输出信息打印到 <code>result.log</code>，将错误信息打印到 <code>error.log</code>。这说明加了 <code>file=sys.stderr</code> 参数的输出，可以在命令行中识别到。</p>

<blockquote>
<p><strong>Note</strong>: 关于 Terminal 快捷键，Mac 用户可以看看 <a href="https://support.apple.com/en-gb/guide/terminal/trmlshtcts/mac">Keyboard shortcuts in Terminal on Mac</a>.</p>
</blockquote>

<!-- ## 设计模式 -->

<p>参考：</p>

<ol>
<li><a href="https://www.youtube.com/watch?v=N5vscPTWKOk">Python Tutorial: virtualenv and why you should use virtual environments</a></li>
<li><a href="http://google.github.io/styleguide/pyguide.html">Google Python Style Guide</a></li>
<li><a href="https://github.com/zh-google-styleguide/zh-google-styleguide">Google 开源项目风格指南 (中文版)</a></li>
<li><a href="https://medium.com/swlh/unit-testing-in-python-code-confidently-and-break-stuff-on-purpose-d246e7167e79">Unit Testing in Python</a></li>
<li><a href="https://medium.com/@mashood.snhu/a-quick-start-guide-to-python-unittest-part-1-9653683637ca">Quick Start Guide to Python unittest</a></li>
<li><a href="https://docs.python.org/3/using/cmdline.html">Command line and environment</a></li>
<li><a href="https://stackoverflow.com/questions/1450393/how-do-you-read-from-stdin/1450396#1450396">How do you read from stdin?</a></li>
</ol>

  </div>
  

<div class="navigation navigation-single">
    
    <a href="/posts/algorithms/" class="navigation-prev">
      <i aria-hidden="true" class="fa fa-chevron-left"></i>
      <span class="navigation-tittle">算法集萃</span>
    </a>
    
    
    <a href="/posts/hadoop_intro/" class="navigation-next">
      <span class="navigation-tittle">漫谈 Hadoop Streaming</span>
      <i aria-hidden="true" class="fa fa-chevron-right"></i>
    </a>
    
</div>


  

  
    


</article>

<style>
  .my-emoji {
    height: 25px;
    display: inline-block;
    margin: 0;
    vertical-align: text-bottom;
  }
</style>


        </div>
        
    <script type="text/javascript" async
  src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
  MathJax.Hub.Config({
  tex2jax: {
    inlineMath: [['$','$'], ['\\(','\\)']],
    displayMath: [['$$','$$']],
    processEscapes: true,
    processEnvironments: true,
    skipTags: ['script', 'noscript', 'style', 'textarea', 'pre'],
    TeX: { equationNumbers: { autoNumber: "AMS" },
         extensions: ["AMSmath.js", "AMSsymbols.js"] }
  }
  });
  MathJax.Hub.Queue(function() {
    
    
    
    var all = MathJax.Hub.getAllJax(), i;
    for(i = 0; i < all.length; i += 1) {
        all[i].SourceElement().parentNode.className += ' has-jax';
    }
  });

  MathJax.Hub.Config({
  
  TeX: { equationNumbers: { autoNumber: "AMS" } }
  });
</script>



<script defer src="/all.js" integrity="sha384-GqVMZRt5Gn7tB9D9q7ONtcp4gtHIUEW/yG7h98J7IpE3kpi+srfFyyB/04OV6pG0" crossorigin="anonymous"></script>

    
    
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.13.1/highlight.min.js"></script>
        
    
    <script type="text/javascript">
        
        hljs.initHighlightingOnLoad();
    </script>
    






    



    </body>
</html>
