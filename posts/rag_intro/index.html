<!DOCTYPE html>
<html lang="zh-cn">
    
    


    <head>
    <link href="https://gmpg.org/xfn/11" rel="profile">
    
    <link rel="canonical" href="https://luochang212.github.io/posts/rag_intro/">
    
    <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<!-- Enable responsiveness on mobile devices -->
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">
<meta name="generator" content="Hugo 0.148.2">

    
    
    

<title>RAGï¼šå¤§æ¨¡å‹æ—¶ä»£çš„æœç´¢åŸºåº§ â€¢ Chang Luo</title>



  <meta name="twitter:card" content="summary">
  <meta name="twitter:title" content="RAGï¼šå¤§æ¨¡å‹æ—¶ä»£çš„æœç´¢åŸºåº§">
  <meta name="twitter:description" content="åŸºäº LangChain å®ç°çš„å‘é‡æ£€ç´¢ã€å…³é”®è¯æ£€ç´¢ã€æ··åˆæ£€ç´¢">
      <meta name="twitter:site" content="@_stellar_tide">

<meta property="og:url" content="https://luochang212.github.io/posts/rag_intro/">
  <meta property="og:site_name" content="Chang Luo">
  <meta property="og:title" content="RAGï¼šå¤§æ¨¡å‹æ—¶ä»£çš„æœç´¢åŸºåº§">
  <meta property="og:description" content="åŸºäº LangChain å®ç°çš„å‘é‡æ£€ç´¢ã€å…³é”®è¯æ£€ç´¢ã€æ··åˆæ£€ç´¢">
  <meta property="og:locale" content="zh_cn">
  <meta property="og:type" content="article">
    <meta property="article:section" content="posts">
    <meta property="article:published_time" content="2025-12-27T00:00:00+00:00">
    <meta property="article:modified_time" content="2025-12-27T00:00:00+00:00">
    <meta property="article:tag" content="RAG">
    <meta property="article:tag" content="LangChain">


    


<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/github.min.css">








<link rel="stylesheet" href="/scss/hyde-hyde.1354666f7c97c95b395dd180ab9cf1aca1ff0408c93996eed446576738e01579.css" integrity="sha256-E1Rmb3yXyVs5XdGAq5zxrKH/BAjJOZbu1EZXZzjgFXk=">


<link rel="stylesheet" href="/scss/print.2744dcbf8a0b2e74f8a50e4b34e5f441be7cf93cc7de27029121c6a09f9e77bc.css" integrity="sha256-J0Tcv4oLLnT4pQ5LNOX0Qb58&#43;TzH3icCkSHGoJ&#43;ed7w=" media="print">




<link rel="stylesheet" href="/scss/tocbot.5ef07cebc3c477b54270456f149ee02922479bb7555fd344b2c69f953b0e7e5e.css" integrity="sha256-XvB868PEd7VCcEVvFJ7gKSJHm7dVX9NEssaflTsOfl4=">



    <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
    <!--[if lt IE 9]>
    <script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
    <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
    <!-- Icons -->
    <link rel="apple-touch-icon-precomposed" sizes="144x144" href="/apple-touch-icon-144-precomposed.png">
    <link rel="shortcut icon" href="/favicon.png">
    
    

</head>


    <body class=" ">
    <head>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <script src="https://upcdn.b0.upaiyun.com/libs/jquery/jquery-1.9.0.min.js"></script>

  <style>
    body {
      transition: background-color .5s;
    }

    #overlay {
      position: fixed;
      display: none;
      width: calc(100vw - 580px);
      height: 100%;
      top: 0;
      left: 0;
       
      z-index: 2;
      cursor: pointer;
    }

    .sidenav {
      height: 100%;
      width: 0;
      position: fixed;
      z-index: 1000;
      top: 0;
      right: 0;
      background-color: #FFF;
      overflow: hidden;
      transition: 0.5s;
    }

    #main {
      transition: margin-left .5s;
       
      padding: 16px;
      position: absolute;
      top: 0;
      right: 0;
      bottom: 0;
      left: 0;
      overflow: hidden;
    }

     
    .tab {
      overflow: hidden;
      border: 1px solid #ccc;
      background-color: #f1f1f1;
    }

     
    .tab button {
      background-color: inherit;
      float: left;
      border: none;
      outline: none;
      cursor: pointer;
      padding: 14px 16px;
      transition: 0.3s;
      font-size: 17px;
    }

     
    .tab button:hover {
      background-color: #ddd;
    }

     
    .tab button.active {
      background-color: #ccc;
    }

     
    .tabcontent {
      display: flex;
      padding: 12px 12px;
      margin: 0;
      border: 1px solid #ccc;
      border-top: none;
      overflow: hidden;
      height: calc(100vh - 90px);
    }

    .dropbtn {
      background-color: #3498DB;
      color: white;
      padding: 16px;
      font-size: 16px;
      border: none;
    }

    .dropup {
      position: relative;
      display: inline-block;
    }

    .dropup-content {
      display: none;
      position: absolute;
      background-color: #f1f1f1;
      min-width: 160px;
      bottom: 50px;
      z-index: 1;
    }

    .dropup-content a {
      color: black;
      padding: 12px 16px;
      text-decoration: none;
      display: block;
    }

    .dropup-content a:hover {
      background-color: #ccc
    }

    .dropup:hover .dropup-content {
      display: block;
    }

    .dropup:hover .dropbtn {
      background-color: #2980B9;
    }

    #video2,
    #video3 {
      display: none;
    }

    .myiframe {
      height: 100%;
      width: 100%;
    }
  </style>

</head>

<body>

  
  <div class="sidebar">
    <div class="container ">
      <div class="sidebar-about">
        <span class="site__title">
          <a href="https://luochang212.github.io/">Chang Luo</a>
        </span>
        
        
        
        <div class="author-image">
          <a href="#" class="load-iframe" onclick="openNav()"><img src="https://luochang212.github.io//images/profile.webp" id="author-iamge"
              alt="Author Image" class="img--circle img--headshot element--center"></a>
        </div>
        
        <p class="site__description">
          
        </p>
      </div>
      <div class="collapsible-menu">
        <input type="checkbox" id="menuToggle">
        <label for="menuToggle">Chang Luo</label>
        <div class="menu-content">
          <div>
	<ul class="sidebar-nav">
		 
		 
			 
				<li>
					<a href="/posts/">
						<span>Posts</span>
					</a>
				</li>
			 
		 
			 
				<li>
					<a href="/portfolio/">
						<span>Projects</span>
					</a>
				</li>
			 
		 
			 
				<li>
					<a href="/about/">
						<span>About Me</span>
					</a>
				</li>
			 
		
	</ul>
</div>

          <section class="social">
	
	<a href="https://twitter.com/_stellar_tide" rel="me"><i class="fab fa-x-twitter fa-lg" aria-hidden="true"></i></a>
	
	
	
	
	<a href="https://github.com/luochang212" rel="me"><i class="fab fa-github fa-lg" aria-hidden="true"></i></a>
	
	
	
	
	
	
	<a href="https://instagram.com/suphenshin" rel="me"><i class="fab fa-instagram fa-lg" aria-hidden="true"></i></a>
	
	
	
	
	
	<a href="https://www.zhihu.com/people/Fashionable" rel="me">
		<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" stroke="none" stroke-width="2" 
			 stroke-linecap="round" stroke-linejoin="round" style="width: 1.25em; height: 1.25em; vertical-align: -0.25em;">
			<path d="m13.3334,3.60098l0,17.1471l1.79582,0l0.75424,2.13703l3.18459,-2.13703l3.93584,0l0,-17.1471l-9.6705,0zm7.41375,14.87538l-1.79283,0l-2.24777,1.50849l-0.53276,-1.50849l-0.53875,0l0,-12.53483l5.10911,0l0,12.53483l0.00299,0zm-8.56906,-7.18927l-3.97475,0c0.06285,-1.34387 0.1287,-3.12174 0.19754,-5.17496l3.91788,0l-0.00299,-0.24244c0,-0.01796 -0.00599,-0.43998 -0.06884,-0.87097c-0.06285,-0.44896 -0.19754,-1.04457 -0.62854,-1.04457l-6.5727,0c0.13169,-0.61657 0.46991,-2.08615 0.87995,-2.80747l0.19155,-0.33522l-0.3861,-0.02095c-0.02394,0 -0.58663,-0.02694 -1.23912,0.31726c-1.06851,0.56868 -1.5474,1.68807 -1.75691,2.52612c-0.55072,2.18791 -1.33489,3.70837 -1.66712,4.35786c-0.09877,0.19155 -0.15863,0.30529 -0.18557,0.38311c-0.05387,0.14666 -0.02394,0.29332 0.0838,0.38909c0.31427,0.28434 1.14334,-0.0868 1.15232,-0.08979c0.01796,-0.00898 0.03891,-0.01796 0.06585,-0.02993c0.41603,-0.18856 1.64916,-0.74826 2.08914,-2.52911l1.69705,0c0.02095,0.96376 0.09278,4.14236 0.0868,5.17496l-4.22018,0l-0.06285,0.0449c-0.69139,0.50582 -0.91288,1.8916 -0.92185,1.95146l-0.0419,0.27536l4.99837,0c-0.36814,2.34355 -0.79315,3.3941 -1.01763,3.81313c-0.11074,0.20951 -0.21849,0.41902 -0.32025,0.62255c-0.63752,1.26306 -1.29898,2.56802 -3.7802,4.5973c-0.10775,0.0838 -0.20951,0.23944 -0.14367,0.41005c0.07183,0.18856 0.27835,0.27237 0.73629,0.27237c0.16162,0 0.35318,-0.00898 0.58065,-0.02993c1.49352,-0.13169 3.01698,-0.53875 4.04359,-2.6219c0.50882,-1.05056 0.94879,-2.14601 1.31394,-3.25941l4.08549,4.78886l0.14965,-0.35916c0.02394,-0.05687 0.56868,-1.38578 0.15264,-2.87032l-0.01497,-0.05387l-3.23547,-3.68143l-0.65847,0.49684c0.19155,-0.78118 0.31726,-1.49352 0.37413,-2.12805l4.74995,0l0,-0.23944c0,-1.20021 -0.55371,-1.91255 -0.57466,-1.94248l-0.07183,-0.08979z" />
		</svg>
	</a>
	
	
	
	
	
	
	
	
	
	
	
	
	
</section>

        </div>
      </div>
      
<div class="copyright">
  &copy; 2025 Chang Luo
  
</div>



    </div>
  </div>

  
  

  <div id="overlay" onclick="off()"></div>

  <div id="mySidenav" class="sidenav">

    <div id="main">
      <div class="tab">
        <button id="default-tab" class="tablinks" onclick="openItem(event, 'Resources')">Resources</button>
        <button class="tablinks" onclick="openItem(event, 'netease-player')">Music</button>
        <button class="tablinks" onclick="openItem(event, 'video-player')">Video</button>
        <button class="tablinks" onclick="openItem(event, 'gallery')">Gallery</button>
        <button class="tablinks" onclick="openItem(event, 'gadget')">Gadget</button>
        <button class="tablinks" onclick="openItem(event, 'categories')">Cats</button>
      </div>

      <div id="Resources" class="tabcontent">
        <iframe class="myiframe"
          src="about:blank"
          data-src="/resources/"
          frameborder="0"
          marginheight="0"
          marginwidth="0"
          scrolling="auto"></iframe>
      </div>

      <div id="netease-player" class="tabcontent">
        <iframe class="myiframe"
          src="about:blank"
          data-src="//music.163.com/outchain/player?type=0&id=2250585392&auto=0&height=430"
          frameborder="no"
          marginheight="0"
          marginwidth="0"
          scrolling="auto"></iframe>
      </div>

      <div id="video-player" class="tabcontent">
        <div id="video1">
          <iframe src="about:blank"
            data-src="//player.bilibili.com/player.html?bvid=BV1Ln4y1d7Z9&p=1&high_quality=1&danmaku=0&autoplay=0"
            style="width:100%; height: 500px"
            scrolling="no"
            frameborder="no"
            framespacing="0"
            allowfullscreen="true"></iframe>
        </div>
        <div id="video2">
          <iframe src="about:blank"
            data-src="//player.bilibili.com/player.html?bvid=BV1rp4y1L7i4&p=1&high_quality=1&danmaku=0&autoplay=0"
            style="width:100%; height: 500px"
            scrolling="no"
            frameborder="no"
            framespacing="0"
            allowfullscreen="true"></iframe>
        </div>
        <div id="video3">
          <iframe src="about:blank"
            data-src="//player.bilibili.com/player.html?bvid=BV1Av4y147QE&p=1&high_quality=1&danmaku=0&autoplay=0"
            style="width:100%; height:500px"
            scrolling="no"
            frameborder="no"
            framespacing="0"
            allowfullscreen="true"></iframe>
        </div>

        

        

        <br>
        <div class="dropup">
          <button class="dropbtn">æ›´å¤šè§†é¢‘</button>
          <div class="dropup-content">
            <a onclick="link1()">ZUTOMYAO</a>
            <a onclick="link2()">å²å²æ‹</a>
            <a onclick="link3()">çœŸç‰©è®º</a>
          </div>
        </div>
      </div>

      <div id="gallery" class="tabcontent">
        <iframe class="myiframe"
        src="about:blank"
        data-src="/gadget/gallery/#two"
        frameborder="0"
        marginheight="0"
        marginwidth="0"
        scrolling="auto"></iframe>
      </div>

      <div id="gadget" class="tabcontent">
        <iframe class="myiframe"
        src="about:blank"
        data-src="/tool/"
        frameborder="0"
        marginheight="0"
        marginwidth="0"
        scrolling="auto"></iframe>
      </div>

      <div id="categories" class="tabcontent">
        <iframe class="myiframe"
        src="about:blank"
        data-src="/categories/"
        frameborder="0"
        marginheight="0"
        marginwidth="0"
        scrolling="auto"></iframe>
      </div>
    </div>
  </div>

  
  <script>
    'use strict'

    function openNav() {
      on();
      document.getElementById("mySidenav").style.width = "580px";
      document.body.style.backgroundColor = "rgba(0,0,0,0.5)";
    }

    function closeNav() {
      document.getElementById("mySidenav").style.width = "0";
      document.body.style.backgroundColor = "white";
    }

    function on() {
      document.getElementById("overlay").style.display = "block";
    }

    function off() {
      closeNav();
      document.getElementById("overlay").style.display = "none";
    }

    
    document.getElementById('default-tab').click();

    function openItem(evt, itemName) {
      var i, tabcontent, tablinks;
      tabcontent = document.getElementsByClassName("tabcontent");
      for (i = 0; i < tabcontent.length; i++) {
        tabcontent[i].style.display = "none";
      }
      tablinks = document.getElementsByClassName("tablinks");
      for (i = 0; i < tablinks.length; i++) {
        tablinks[i].className = tablinks[i].className.replace(" active", "");
      }
      document.getElementById(itemName).style.display = "block";
      evt.currentTarget.className += " active";
    }

    function link1() {
      document.getElementById("video1").style.display = "block";
      document.getElementById("video2").style.display = "none";
      document.getElementById("video3").style.display = "none";
    }

    function link2() {
      document.getElementById("video1").style.display = "none";
      document.getElementById("video2").style.display = "block";
      document.getElementById("video3").style.display = "none";
    }

    function link3() {
      document.getElementById("video1").style.display = "none";
      document.getElementById("video2").style.display = "none";
      document.getElementById("video3").style.display = "block";
    }

     
    var flag = 0;

     
    $(".load-iframe").click(function () {
      if (flag < 1) {
        $("iframe").each(function () {
          $(this).attr("src", $(this).data("src"));
        });
        flag = flag + 1;
      }
    });
  </script>

</body>



        <div class="content container">
            
    <style>
  .my-emoji {
    height: 25px;
    display: inline-block;
    margin: 0;
    vertical-align: text-bottom;
  }

  .social-links a {
    color: rgba(120,120,120,1);
    text-decoration: none;
    outline: none !important;
    cursor: pointer;
    transition-property: padding, text-shadow, line-height, color, background, opacity, transform;
    transition-duration: .25s;
    transition-timing-function: ease-in-out;
    display: inline-block;
    white-space: nowrap;
    position: relative;
  }

  .social-links a:after {
    content: "";
    display: block;
    height: .125rem;
    margin: -.125rem 0 0;
    background: rgba(0,0,0,.5);
    border-radius: 1px;
    transform: scaleX(0);
    transition: transform .25s ease-in-out;
  }

  .social-links a:hover:after {
    transform: scaleX(1);
  }

  .social-links a:hover {
    color: rgba(120,120,120,1);
  }

  .post {
    margin-bottom: 0;
  }

  .post-footer {
    margin-top: 0;
    padding-top: 0.5rem;
  }
</style>



<article>
  <header>
    <h1>RAGï¼šå¤§æ¨¡å‹æ—¶ä»£çš„æœç´¢åŸºåº§</h1>
    
    
<div class="post__meta">
    
    
      <i class="fas fa-calendar-alt"></i> Dec 27, 2025
    
    
    
      
      
          in
          
          
              <a class="badge badge-category" href="/categories/agent">AGENT</a>
              
          
      
    
    
    
      
      
          <br/>
           <i class="fas fa-tags"></i>
          
          <a class="badge badge-tag" href="/tags/rag">rag</a>
           
      
          <a class="badge badge-tag" href="/tags/langchain">langchain</a>
          
      
    
    
    <br/>
    <i class="fas fa-clock"></i> 6 min read
</div>


  </header>
  
  
  
  <div class="toc-wrapper">
    <input type="checkbox" id="tocToggle">
    <label for="tocToggle">ç›®å½•</label>
    
    <div class="toc" id="TableOfContents"></div>
    
  </div>
  
  
  <div class="post">
    <blockquote>
<p>æ²¡æœ‰ä¸€æ¡å¸†èˆ¹èƒ½å¹åŠ¨è‡ªå·±è¡Œé©¶ï¼Œå®ƒéœ€è¦å¤–é¢çš„é£ã€‚ &ndash; å› å¯è§…ã€Šé‡å­ç¦»æ­Œã€‹</p></blockquote>
<p>å¤§æ¨¡å‹çš„è®­ç»ƒæ•°æ®æœ‰æˆªæ­¢æ—¥æœŸï¼Œåœ¨æ­¤ä¹‹åçš„äº‹å®ƒä¸çŸ¥é“ï¼›å¤§æ¨¡å‹çš„å‚æ•°é‡æœ‰é™ï¼Œæ— æ³•å®¹çº³æ‰€æœ‰ä¸“ä¸šçŸ¥è¯†ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œå¤§æ¨¡å‹åœ¨å®æ—¶æ€§å’Œä¸“ä¸šæ€§ä¸Šéƒ½æœ‰æ‰€æ¬ ç¼ºã€‚</p>
<p>å¦‚ä½•è®©å¤§æ¨¡å‹å˜å¾—å®æ—¶ä¸”ä¸“ä¸šå‘¢ï¼Ÿæœ€çœåŠ›çš„æ–¹æ³•æ˜¯â€œæ‰“å°æŠ„â€ã€‚<strong>çŸ¥è¯†åº“</strong> å°±åƒå¤§æ¨¡å‹çš„â€œå°æŠ„â€ã€‚åœ¨å›ç­”é—®é¢˜ä¹‹å‰ï¼Œå…ˆç…ä¸€çœ¼å°æŠ„ï¼Œçœ‹æœ‰æ²¡æœ‰ä¸é—®é¢˜ç›¸å…³çš„å†…å®¹ã€‚å¦‚æœæœ‰ï¼Œå°±ä»çŸ¥è¯†åº“ä¸­å–å›è¿™æ®µå†…å®¹ï¼Œç»“åˆå¤§æ¨¡å‹çš„æ¨ç†èƒ½åŠ›ï¼Œç”Ÿæˆæœ€ç»ˆç­”æ¡ˆã€‚</p>
<p>è¿™é‡Œã€Œæ‰“å°æŠ„ã€çš„åŠ¨ä½œï¼Œå°±æ˜¯ <a href="https://docs.langchain.com/oss/python/langchain/retrieval"><strong>RAG</strong></a>ï¼ˆRetrieval-Augmented Generation, æ£€ç´¢å¢å¼ºç”Ÿæˆï¼‰ã€‚</p>
<blockquote>
<p><strong>Note:</strong> ä½¿ç”¨çŸ¥è¯†åº“å¯ä»¥è®©å¤§æ¨¡å‹çš„å›ç­”æœ‰æ®å¯ä¾ã€å‡å°‘å¹»è§‰ï¼Œä»£ä»·æ˜¯éœ€è¦æ‰¿æ‹…çŸ¥è¯†åº“çš„æ„å»ºæˆæœ¬ã€‚å°¤å…¶å½“çŸ¥è¯†åº“çš„è§„æ¨¡è¾ƒå¤§æ—¶ï¼Œæœ‰å¿…è¦æƒ³æƒ³æ˜¯å¦å€¼å¾—æ”¯ä»˜å¯¹ä»·ã€‚æ¯•ç«Ÿï¼Œé€šè¿‡æ‰©å¤§çŸ¥è¯†åº“çš„æ–¹å¼æå‡ Agent æ€§èƒ½ï¼Œå¤šå°‘æœ‰ç‚¹ã€Œç”¨æœ‰é™å¯¹æŠ—æ— é™ï¼Œç”¨ç¡®å®šå¯¹æŠ—ä¸ç¡®å®šã€çš„æ„æ€ã€‚è™½ç„¶æˆ‘ä»¬æ€»æ˜¯åœ¨æèµ· RAG æ—¶æåˆ°çŸ¥è¯†åº“ï¼Œä½† RAG æ˜¯ä¸€ç§æ£€ç´¢æŠ€æœ¯ï¼Œå®ƒå¯ä»¥æ£€ç´¢ä»»ä½•å†…å®¹ã€‚æ¯”èµ·æ£€ç´¢éœ€è¦æ‰‹åŠ¨æ„å»ºçš„çŸ¥è¯†åº“ï¼Œç”¨æ¥æ£€ç´¢è”ç½‘å†…å®¹ã€å†å²å¯¹è¯ä¹Ÿæ˜¯å¯ä»¥çš„ï¼Œè€Œä¸”æ€§ä»·æ¯”å¾ˆé«˜ã€‚ä½ çš„ä¸‹ä¸€ä¸ªæ£€ç´¢å¯¹è±¡ï¼Œåˆä½•å¿…æ˜¯çŸ¥è¯†åº“ã€‚</p></blockquote>
<h2 id="ä¸€æç¤ºè¯æ¨¡æ¿">ä¸€ã€æç¤ºè¯æ¨¡æ¿</h2>
<p>RAG åšçš„äº‹æƒ…å¹¶ä¸å¤æ‚ï¼Œå°±æ˜¯ä»çŸ¥è¯†åº“ä¸­å¬å›ä¸ç”¨æˆ·é—®é¢˜æœ‰å…³çš„å†…å®¹ï¼Œä½œä¸ºä¸Šä¸‹æ–‡æ³¨å…¥åˆ° <strong>æç¤ºè¯æ¨¡æ¿ (Prompt Template)</strong> ä¸­ã€‚</p>
<p>ä¸‹é¢æ˜¯ä¸€ä¸ªæç¤ºè¯æ¨¡æ¿ï¼š</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-text" data-lang="text"><span style="display:flex;"><span>{context}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>---
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>åŸºäºä¸Šé¢ç»™å‡ºçš„ä¸Šä¸‹æ–‡ï¼Œå›ç­”é—®é¢˜ã€‚
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>é—®é¢˜ï¼š{question}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>å›ç­”ï¼š 
</span></span></code></pre></div><p>ä½¿ç”¨è¯¥æ¨¡æ¿æ—¶ï¼Œå°†å¬å›æ–‡æœ¬å¡«å…¥ <code>{context}</code>ï¼Œå°†ç”¨æˆ·é—®é¢˜å¡«å…¥ <code>{question}</code>ã€‚ç„¶åæŠŠå¡«å¥½çš„æç¤ºè¯æ¨¡æ¿äº¤ç»™å¤§æ¨¡å‹æ¨ç†ã€‚</p>
<p>RAG ä¸»è¦åšäº†ä¸¤ä»¶äº‹ï¼šä¸€æ˜¯ä»çŸ¥è¯†åº“ä¸­ <strong>å¬å›</strong> ä¸ç”¨æˆ·é—®é¢˜æœ‰å…³çš„æ–‡æœ¬ï¼ŒäºŒæ˜¯ä½¿ç”¨æç¤ºè¯æ¨¡æ¿ <strong>æ‹¼æ¥</strong> å¬å›æ–‡æœ¬ä¸ç”¨æˆ·é—®é¢˜ã€‚æ‹¼æ¥å¾ˆå®¹æ˜“åšåˆ°ï¼Œéš¾åº¦ä¸»è¦é›†ä¸­åœ¨å¬å›ä¸Šã€‚åœ¨ä¸‹ä¸€å°èŠ‚ä¸­ï¼Œæˆ‘å°†ä»‹ç»å¦‚ä½•å¬å›ä¸ç”¨æˆ·é—®é¢˜æœ‰å…³çš„æ–‡æœ¬ã€‚</p>
<h2 id="äºŒå‘é‡æ£€ç´¢">äºŒã€å‘é‡æ£€ç´¢</h2>
<p>å®Œæˆã€Œå¬å›ä¸ç”¨æˆ·é—®é¢˜æœ‰å…³çš„ã€è¿™ä»¶äº‹ï¼Œéœ€è¦ç”¨åˆ°æ£€ç´¢å™¨ã€‚å®ç°æ£€ç´¢å™¨çš„æ–¹å¼æœ‰ <a href="https://docs.langchain.com/oss/python/integrations/retrievers">å¾ˆå¤š</a>ï¼Œæ¯”å¦‚åŸºäºå…³é”®è¯æ£€ç´¢çš„ <a href="https://docs.langchain.com/oss/python/integrations/retrievers/bm25">BM25</a> ç®—æ³•ï¼Œä½†æœ¬èŠ‚ä¸»è¦ä»‹ç»åŸºäº Embedding çš„æ£€ç´¢æ–¹æ³•ï¼š<strong>å‘é‡æ£€ç´¢</strong>ã€‚</p>
<h3 id="1ä»æ–‡æœ¬å‘é‡åŒ–è¯´èµ·">1ï¼‰ä»æ–‡æœ¬å‘é‡åŒ–è¯´èµ·</h3>
<p>Embedding æ˜¯ä¸€ç§å°†æ–‡æœ¬è½¬ä¸ºå‘é‡çš„æŠ€æœ¯ã€‚å®ƒçš„è¾“å…¥æ˜¯ä¸€æ®µæ–‡æœ¬ï¼Œè¾“å‡ºæ˜¯ä¸€ä¸ªå®šé•¿çš„å‘é‡ã€‚</p>
<pre tabindex="0"><code>&#34;å¥½å–œæ¬¢ä½ &#34; --&gt; [0.190012, 0.123555, .... ]
</code></pre><p>å°†æ–‡æœ¬è½¬ä¸ºå‘é‡çš„ç›®çš„ï¼Œæ˜¯æŠŠè¯­ä¹‰ç›¸è¿‘çš„è¯åˆ†é…åˆ°åŒä¸€ç‰‡å‘é‡ç©ºé—´ã€‚æ‰€ä»¥ï¼Œä¸€å¯¹è¿‘ä¹‰è¯è½¬æˆå‘é‡åï¼Œå®ƒä»¬çš„å‘é‡ä¹‹é—´çš„è·ç¦»é€šå¸¸æ¯”å…¶ä»–è¯æ›´è¿‘ã€‚æ¯”å¦‚ï¼Œè¶³çƒå’Œç¯®çƒåœ¨å‘é‡ç©ºé—´ä¸­çš„è·ç¦»æ›´è¿‘ä¸€äº›ï¼Œè€Œè¶³çƒå’Œç¯®ç­ä¹‹é—´çš„è·ç¦»æ›´è¿œã€‚Embedding çš„æœ¬è´¨æ˜¯å‹ç¼©ã€‚ä»ç¼–ç è§’åº¦è®²ï¼Œè‡ªç„¶è¯­è¨€å­˜åœ¨å†—ä½™ä¿¡æ¯ã€‚Embedding ç›¸å½“äºå¯¹è‡ªç„¶è¯­è¨€è¿›è¡Œé‡ç¼–ç ï¼Œç”¨æœ€å°‘çš„ token è¡¨è¾¾æœ€å¤šçš„è¯­ä¹‰ã€‚</p>
<p>Embedding åœ¨å¤šè¯­è¨€åœºæ™¯ä¸‹ä¹Ÿæœ‰ä¼˜åŠ¿ã€‚ç»è¿‡å……åˆ†è®­ç»ƒçš„ Embedding æ¨¡å‹ï¼Œä¼šå°†å¤šè¯­è¨€å†…å®¹åœ¨è¯­ä¹‰å±‚é¢ä¸Šå¯¹é½ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œä¸€ä¸ªå‘é‡å¯ä»¥åœ¨å¤šè¯­è¨€ç¯å¢ƒä¸­ä¿æŒåŒä¸€è¯­ä¹‰ã€‚è¿™ç§ç‰¹æ€§è®©å¤§æ¨¡å‹å¾—ä»¥å…¼å®¹å¹¶åŒ…ã€‚å³ä½¿åŠ å…¥å¤šè¯­è¨€ææ–™ï¼Œä¹Ÿä¸ä¼šå› ä¸ºå­—é¢ä¸Šçš„è¯ä¸åŒï¼Œè€Œäº§ç”Ÿâ€œç†è§£â€ä¸Šçš„æ··ä¹±ã€‚</p>
<h3 id="2å‘é‡æ£€ç´¢çš„åŸç†">2ï¼‰å‘é‡æ£€ç´¢çš„åŸç†</h3>
<p>ç”±äº Embedding æ¨¡å‹å…·æœ‰å°†ç›¸ä¼¼è¯­ä¹‰çš„è¯è®­ç»ƒæˆè·ç¦»ç›¸è¿‘çš„å‘é‡çš„ç‰¹æ€§ï¼Œæˆ‘ä»¬å¯ä»¥æŠŠã€Œç”¨æˆ·é—®é¢˜ã€ä¸ã€ŒçŸ¥è¯†åº“å†…å®¹ã€éƒ½è½¬æˆ Embedding å‘é‡ã€‚ç„¶åè®¡ç®—å‘é‡ä¹‹é—´çš„è·ç¦»ã€‚å‘é‡ä¹‹é—´çš„è·ç¦»è¶Šå°ï¼Œåˆ™è¯­æ–™ä¹‹é—´çš„ç›¸ä¼¼åº¦è¶Šé«˜ã€‚å€ŸåŠ©è¿™ä¸ªåŸç†ï¼Œæœ€åè¿”å›çŸ¥è¯†åº“ä¸­ä¸é—®é¢˜å‘é‡è·ç¦»æœ€å°çš„ Top-K ä»½è¯­æ–™å³å¯ã€‚</p>
<p>æˆ‘ä»¬ç”¨ä¸€ä¸ªç®€å•çš„å®éªŒï¼ŒéªŒè¯è¿™ç§è®¡ç®—æ–¹å¼èƒ½å¦è·å–çœŸæ­£çš„ç›¸å…³æ–‡æœ¬ã€‚</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#cf222e">from</span> <span style="color:#24292e">dotenv</span> <span style="color:#cf222e">import</span> load_dotenv
</span></span><span style="display:flex;"><span><span style="color:#cf222e">from</span> <span style="color:#24292e">langchain_community.embeddings</span> <span style="color:#cf222e">import</span> DashScopeEmbeddings
</span></span><span style="display:flex;"><span><span style="color:#cf222e">from</span> <span style="color:#24292e">sklearn.metrics.pairwise</span> <span style="color:#cf222e">import</span> cosine_similarity
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#57606a"># åŠ è½½ç¯å¢ƒå˜é‡</span>
</span></span><span style="display:flex;"><span>_ <span style="color:#0550ae">=</span> load_dotenv<span style="color:#1f2328">()</span>
</span></span></code></pre></div><p>ä¸‹é¢è®¡ç®—çŸ¥è¯†åº“ä¸­æ¯ä¸€æ¡å†…å®¹ä¸é—®é¢˜ä¹‹é—´çš„ç›¸ä¼¼åº¦ï¼Œçœ‹çœ‹è¯­ä¹‰ç›¸è¿‘çš„å†…å®¹æ˜¯å¦å…·æœ‰æ›´é«˜çš„ä½™å¼¦ç›¸ä¼¼åº¦ã€‚</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#57606a"># ç”¨æˆ·é—®é¢˜</span>
</span></span><span style="display:flex;"><span>query <span style="color:#0550ae">=</span> <span style="color:#0a3069">&#34;è¿‡å¹´è¦ç»™ä¸ç†Ÿçš„äº²æˆšå‘çº¢åŒ…ä¹ˆï¼Ÿ&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#57606a"># çŸ¥è¯†åº“</span>
</span></span><span style="display:flex;"><span>docs <span style="color:#0550ae">=</span> <span style="color:#1f2328">[</span>
</span></span><span style="display:flex;"><span>    <span style="color:#0a3069">&#34;ä¸æ¥å¾€çš„äººå°±ä¸è¦ç»™ä»–é’±&#34;</span><span style="color:#1f2328">,</span>
</span></span><span style="display:flex;"><span>    <span style="color:#0a3069">&#34;æµ·èƒ†è±†è…çœŸå¥½åƒä¸‹æ¬¡è¿˜åƒ&#34;</span><span style="color:#1f2328">,</span>
</span></span><span style="display:flex;"><span>    <span style="color:#0a3069">&#34;åŠç†Ÿç‰›æ’æ·‹ä¸Šä¸ç†Ÿçš„èŠå£«&#34;</span><span style="color:#1f2328">,</span>
</span></span><span style="display:flex;"><span><span style="color:#1f2328">]</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#57606a"># åˆå§‹åŒ–å‘é‡ç”Ÿæˆå™¨</span>
</span></span><span style="display:flex;"><span>embeddings <span style="color:#0550ae">=</span> DashScopeEmbeddings<span style="color:#1f2328">()</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#57606a"># ç”Ÿæˆå‘é‡</span>
</span></span><span style="display:flex;"><span>qv <span style="color:#0550ae">=</span> embeddings<span style="color:#0550ae">.</span>embed_query<span style="color:#1f2328">(</span>query<span style="color:#1f2328">)</span>
</span></span><span style="display:flex;"><span>dv <span style="color:#0550ae">=</span> embeddings<span style="color:#0550ae">.</span>embed_documents<span style="color:#1f2328">(</span>docs<span style="color:#1f2328">)</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#57606a"># è®¡ç®—ä½™å¼¦ç›¸ä¼¼åº¦</span>
</span></span><span style="display:flex;"><span>similarities <span style="color:#0550ae">=</span> cosine_similarity<span style="color:#1f2328">([</span>qv<span style="color:#1f2328">],</span> dv<span style="color:#1f2328">)[</span><span style="color:#0550ae">0</span><span style="color:#1f2328">]</span>
</span></span><span style="display:flex;"><span>results <span style="color:#0550ae">=</span> <span style="color:#6639ba">list</span><span style="color:#1f2328">(</span><span style="color:#6639ba">enumerate</span><span style="color:#1f2328">(</span>similarities<span style="color:#1f2328">))</span>
</span></span><span style="display:flex;"><span>by_sim <span style="color:#0550ae">=</span> <span style="color:#6639ba">sorted</span><span style="color:#1f2328">(</span>results<span style="color:#1f2328">,</span> key<span style="color:#0550ae">=</span><span style="color:#cf222e">lambda</span> r<span style="color:#1f2328">:</span> r<span style="color:#1f2328">[</span><span style="color:#0550ae">1</span><span style="color:#1f2328">],</span> reverse<span style="color:#0550ae">=</span><span style="color:#cf222e">True</span><span style="color:#1f2328">)</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#57606a"># ä½™å¼¦ç›¸ä¼¼åº¦å¤§ -&gt; ä¸¤ä¸ªå•ä½å‘é‡å¤¹è§’å° -&gt; å‘é‡æŒ¨å¾—æ›´è¿‘</span>
</span></span><span style="display:flex;"><span><span style="color:#6639ba">print</span><span style="color:#1f2328">(</span><span style="color:#0a3069">&#34;æŒ‰ä½™å¼¦ç›¸ä¼¼åº¦æ’åºï¼š&#34;</span><span style="color:#1f2328">)</span>
</span></span><span style="display:flex;"><span><span style="color:#cf222e">for</span> i<span style="color:#1f2328">,</span> s <span style="color:#0550ae">in</span> by_sim<span style="color:#1f2328">:</span>
</span></span><span style="display:flex;"><span>    <span style="color:#6639ba">print</span><span style="color:#1f2328">(</span><span style="color:#0a3069">&#39;-&#39;</span><span style="color:#1f2328">,</span> docs<span style="color:#1f2328">[</span>i<span style="color:#1f2328">],</span> s<span style="color:#1f2328">)</span>
</span></span></code></pre></div><p>è¾“å‡ºç»“æœï¼š</p>
<pre tabindex="0"><code>æŒ‰ä½™å¼¦ç›¸ä¼¼åº¦æ’åºï¼š
- ä¸æ¥å¾€çš„äººå°±ä¸è¦ç»™ä»–é’± 0.346204651165491
- åŠç†Ÿç‰›æ’æ·‹ä¸Šä¸ç†Ÿçš„èŠå£« 0.11805922713791331
- æµ·èƒ†è±†è…çœŸå¥½åƒä¸‹æ¬¡è¿˜åƒ 0.09085072283609508
</code></pre><h2 id="ä¸‰å‘é‡æ£€ç´¢æµç¨‹">ä¸‰ã€å‘é‡æ£€ç´¢æµç¨‹</h2>
<p>ä¸Šè¿°ä»£ç è™½ç„¶å·²ç»å¯ä»¥è®¡ç®—çŸ¥è¯†åº“å†…å®¹ä¸ç”¨æˆ·é—®é¢˜çš„ç›¸ä¼¼åº¦ï¼Œä½†åœ¨å·¥ç¨‹åŒ–è¿‡ç¨‹ä¸­è¿˜ä¼šé‡åˆ°ä¸€äº›é—®é¢˜ï¼š</p>
<ul>
<li><strong>é—®é¢˜ä¸€</strong>ï¼šEmbedding æ¨¡å‹å¯¹è¾“å…¥æ–‡æœ¬æœ‰é•¿åº¦é™åˆ¶ï¼Œä¸”æ–‡æœ¬è¿‡é•¿æœ¬èº«ä¹Ÿä¼šå½±å“å‘é‡è¡¨è¾¾</li>
<li><strong>é—®é¢˜äºŒ</strong>ï¼šå½“çŸ¥è¯†åº“è§„æ¨¡è¾ƒå¤§æ—¶ï¼Œéš¾ä»¥å¿«é€Ÿå¬å› Top-K ç›¸å…³æ–‡æœ¬</li>
</ul>
<p>ä¸ºäº†è§£å†³ <strong>é—®é¢˜ä¸€</strong>ï¼Œæˆ‘ä»¬éœ€è¦åšæ–‡æœ¬åˆ‡å—ï¼ˆSplit into chunksï¼‰ï¼šå°†çŸ¥è¯†åº“ä¸­çš„æ–‡æœ¬åˆ‡æˆå¤§å°å‡åŒ€çš„æ–‡æœ¬ç‰‡æ®µã€‚ç„¶åä½¿ç”¨ Embedding æ¨¡å‹å°†è¿™äº›æ–‡æœ¬ç‰‡æ®µè½¬æˆ Embedding å‘é‡ã€‚ä¸ºäº†ç¡®ä¿æ–‡æœ¬ç‰‡æ®µä¸ä¼šå› æˆªæ–­äº§ç”Ÿè¯­ä¹‰ç¼ºå¤±ï¼Œè¿˜è¦è®©ä¸¤ä¸ªç›¸é‚»æ–‡æœ¬ç‰‡æ®µä¹‹é—´æœ‰ä¸€å®šçš„ overlapã€‚<strong>é—®é¢˜äºŒ</strong> ä¸€èˆ¬å¼•å…¥å‘é‡æ•°æ®åº“è§£å†³ï¼Œå‘é‡æ•°æ®åº“æœ‰æˆç†Ÿçš„ <a href="https://milvus.io/docs/single-vector-search.md">ANN</a> ç®—æ³•ï¼Œå¯ä»¥å¸®åŠ©æˆ‘ä»¬å¿«é€Ÿå¬å›æœ€è¿‘é‚»å‘é‡ã€‚</p>
<p>å·¥ç¨‹åŒ–ä¹‹åï¼Œæˆ‘ä»¬çš„æ£€ç´¢æµç¨‹å˜å¾—æ›´å¤æ‚äº†ä¸€äº›ã€‚ä¸‹é¢æ˜¯ä¸€ä¸ªå…¸å‹çš„ <a href="https://docs.langchain.com/oss/python/langchain/retrieval#retrieval-pipeline">å‘é‡æ£€ç´¢æµç¨‹</a>ï¼š</p>
<p><img src="/img/vector-retrieval.png" alt="vector-retrieval"></p>
<p><em>* åœ†æ¡†ä»£è¡¨æ•°æ®ï¼Œæ–¹æ¡†ä»£è¡¨ç»„ä»¶ã€‚</em></p>
<p>ç”±äº LangChain ä½¿ç”¨æ¨¡å—åŒ–çš„ç¼–å†™æ–¹å¼ï¼Œæ‰€ä»¥æ¯ä¸ªç»„ä»¶éƒ½æ˜¯å¯æ›¿æ¢çš„ã€‚ä¸‹é¢ç²—ä½“éƒ¨åˆ†åˆ—å‡ºäº†å›¾ä¸­çš„ç»„ä»¶ï¼Œå³è¾¹æ˜¯å®ƒä»¬å¯æ›¿æ¢çš„å˜ä½“ï¼š</p>
<ul>
<li><strong>Document Loaderï¼ˆæ–‡æ¡£åŠ è½½å™¨ï¼‰</strong>ï¼š<code>TextLoader</code>, <code>PyMuPDFLoader</code>, <code>WebBaseLoader</code></li>
<li><strong>Document Splitterï¼ˆæ–‡æ¡£åˆ†å‰²å™¨ï¼‰</strong>ï¼š<code>RecursiveCharacterTextSplitter</code></li>
<li><strong>Embedding Generationï¼ˆå‘é‡ç”Ÿæˆå™¨ï¼‰</strong>ï¼š<code>DashScopeEmbeddings</code>, <code>HuggingFaceEmbeddings</code></li>
<li><strong>Vector Storeï¼ˆå‘é‡å­˜å‚¨ï¼‰</strong>ï¼š<code>Chroma</code>, <code>Milvus</code>, <code>FAISS</code></li>
<li><strong>Retrieverï¼ˆæ£€ç´¢å™¨ï¼‰</strong>ï¼š<code>EnsembleRetriever</code>, <code>BM25Retriever</code></li>
<li><strong>LLMï¼ˆå¤§è¯­è¨€æ¨¡å‹ï¼‰</strong>ï¼š<code>ChatOpenAI</code></li>
</ul>
<p>ä¸‹ä¸€å°èŠ‚ï¼Œæˆ‘ä»¬å°†å®ç°ä¸€ä¸ªåŒ…å«ä¸Šè¿°å…¨éƒ¨ç»„ä»¶çš„å‘é‡æ£€ç´¢æµç¨‹ã€‚</p>
<h2 id="å››åŸºäºå‘é‡æ£€ç´¢çš„-rag">å››ã€åŸºäºå‘é‡æ£€ç´¢çš„ RAG</h2>
<p>â˜ï¸ğŸ¤“ ä»…éœ€å…­ä¸ªæ­¥éª¤ï¼Œå°±èƒ½å®ç°ä¸€ä¸ªåŸºäºå‘é‡æ£€ç´¢çš„ RAGã€‚</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#cf222e">import</span> <span style="color:#24292e">os</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#57606a"># é…ç½® UA</span>
</span></span><span style="display:flex;"><span>MY_USER_AGENT <span style="color:#0550ae">=</span> <span style="color:#1f2328">(</span>
</span></span><span style="display:flex;"><span>    <span style="color:#0a3069">&#34;Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/605.1.15 &#34;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#0a3069">&#34;(KHTML, like Gecko) Version/17.0 Safari/605.1.15&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#1f2328">)</span>
</span></span><span style="display:flex;"><span>os<span style="color:#0550ae">.</span>environ<span style="color:#1f2328">[</span><span style="color:#0a3069">&#34;USER_AGENT&#34;</span><span style="color:#1f2328">]</span> <span style="color:#0550ae">=</span> MY_USER_AGENT
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#cf222e">import</span> <span style="color:#24292e">bs4</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#cf222e">from</span> <span style="color:#24292e">dotenv</span> <span style="color:#cf222e">import</span> load_dotenv
</span></span><span style="display:flex;"><span><span style="color:#cf222e">from</span> <span style="color:#24292e">langchain_openai</span> <span style="color:#cf222e">import</span> ChatOpenAI
</span></span><span style="display:flex;"><span><span style="color:#cf222e">from</span> <span style="color:#24292e">langchain_community.document_loaders</span> <span style="color:#cf222e">import</span> WebBaseLoader
</span></span><span style="display:flex;"><span><span style="color:#cf222e">from</span> <span style="color:#24292e">langchain_text_splitters</span> <span style="color:#cf222e">import</span> RecursiveCharacterTextSplitter
</span></span><span style="display:flex;"><span><span style="color:#cf222e">from</span> <span style="color:#24292e">langchain_community.embeddings</span> <span style="color:#cf222e">import</span> DashScopeEmbeddings
</span></span><span style="display:flex;"><span><span style="color:#cf222e">from</span> <span style="color:#24292e">langchain_core.vectorstores</span> <span style="color:#cf222e">import</span> InMemoryVectorStore
</span></span><span style="display:flex;"><span><span style="color:#cf222e">from</span> <span style="color:#24292e">langchain.tools</span> <span style="color:#cf222e">import</span> tool
</span></span><span style="display:flex;"><span><span style="color:#cf222e">from</span> <span style="color:#24292e">langchain.agents</span> <span style="color:#cf222e">import</span> create_agent
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#57606a"># åŠ è½½æ¨¡å‹é…ç½®</span>
</span></span><span style="display:flex;"><span>_ <span style="color:#0550ae">=</span> load_dotenv<span style="color:#1f2328">()</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#57606a"># åŠ è½½æ¨¡å‹</span>
</span></span><span style="display:flex;"><span>llm <span style="color:#0550ae">=</span> ChatOpenAI<span style="color:#1f2328">(</span>
</span></span><span style="display:flex;"><span>    model<span style="color:#0550ae">=</span><span style="color:#0a3069">&#34;qwen3-max&#34;</span><span style="color:#1f2328">,</span>
</span></span><span style="display:flex;"><span>    api_key<span style="color:#0550ae">=</span>os<span style="color:#0550ae">.</span>getenv<span style="color:#1f2328">(</span><span style="color:#0a3069">&#34;DASHSCOPE_API_KEY&#34;</span><span style="color:#1f2328">),</span>
</span></span><span style="display:flex;"><span>    base_url<span style="color:#0550ae">=</span>os<span style="color:#0550ae">.</span>getenv<span style="color:#1f2328">(</span><span style="color:#0a3069">&#34;DASHSCOPE_BASE_URL&#34;</span><span style="color:#1f2328">),</span>
</span></span><span style="display:flex;"><span><span style="color:#1f2328">)</span>
</span></span></code></pre></div><h3 id="1åŠ è½½æ–‡æ¡£">1ï¼‰åŠ è½½æ–‡æ¡£</h3>
<p>ä½¿ç”¨ <code>WebBaseLoader</code> åŠ è½½ <a href="https://luochang212.github.io/posts/quick_bi_intro/">ã€Šé˜¿é‡Œå‘å¸ƒæ–°ç‰ˆ Quick BIï¼ŒèŠèŠ ChatBI çš„åº•å±‚æ¶æ„ã€äº¤äº’è®¾è®¡å’Œäº‘è®¡ç®—ç”Ÿæ€ã€‹</a> è¿™ç¯‡æ–‡ç« çš„å†…å®¹ã€‚</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#57606a"># åŠ è½½æ–‡ç« å†…å®¹</span>
</span></span><span style="display:flex;"><span>bs4_strainer <span style="color:#0550ae">=</span> bs4<span style="color:#0550ae">.</span>SoupStrainer<span style="color:#1f2328">(</span>class_<span style="color:#0550ae">=</span><span style="color:#1f2328">(</span><span style="color:#0a3069">&#34;post&#34;</span><span style="color:#1f2328">))</span>
</span></span><span style="display:flex;"><span>loader <span style="color:#0550ae">=</span> WebBaseLoader<span style="color:#1f2328">(</span>
</span></span><span style="display:flex;"><span>    web_paths<span style="color:#0550ae">=</span><span style="color:#1f2328">(</span><span style="color:#0a3069">&#34;https://luochang212.github.io/posts/quick_bi_intro/&#34;</span><span style="color:#1f2328">,),</span>
</span></span><span style="display:flex;"><span>    bs_kwargs<span style="color:#0550ae">=</span><span style="color:#1f2328">{</span><span style="color:#0a3069">&#34;parse_only&#34;</span><span style="color:#1f2328">:</span> bs4_strainer<span style="color:#1f2328">},</span>
</span></span><span style="display:flex;"><span>    requests_kwargs<span style="color:#0550ae">=</span><span style="color:#1f2328">{</span><span style="color:#0a3069">&#34;headers&#34;</span><span style="color:#1f2328">:</span> <span style="color:#1f2328">{</span><span style="color:#0a3069">&#34;User-Agent&#34;</span><span style="color:#1f2328">:</span> MY_USER_AGENT<span style="color:#1f2328">}},</span>
</span></span><span style="display:flex;"><span><span style="color:#1f2328">)</span>
</span></span><span style="display:flex;"><span>docs <span style="color:#0550ae">=</span> loader<span style="color:#0550ae">.</span>load<span style="color:#1f2328">()</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#cf222e">assert</span> <span style="color:#6639ba">len</span><span style="color:#1f2328">(</span>docs<span style="color:#1f2328">)</span> <span style="color:#0550ae">==</span> <span style="color:#0550ae">1</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#6639ba">print</span><span style="color:#1f2328">(</span><span style="color:#0a3069">f</span><span style="color:#0a3069">&#34;Total characters: </span><span style="color:#0a3069">{</span><span style="color:#6639ba">len</span><span style="color:#1f2328">(</span>docs<span style="color:#1f2328">[</span><span style="color:#0550ae">0</span><span style="color:#1f2328">]</span><span style="color:#0550ae">.</span>page_content<span style="color:#1f2328">)</span><span style="color:#0a3069">}</span><span style="color:#0a3069">&#34;</span><span style="color:#1f2328">)</span>
</span></span><span style="display:flex;"><span><span style="color:#6639ba">print</span><span style="color:#1f2328">(</span>docs<span style="color:#1f2328">[</span><span style="color:#0550ae">0</span><span style="color:#1f2328">]</span><span style="color:#0550ae">.</span>page_content<span style="color:#1f2328">[:</span><span style="color:#0550ae">248</span><span style="color:#1f2328">])</span>
</span></span></code></pre></div><h3 id="2åˆ†å‰²æ–‡æ¡£">2ï¼‰åˆ†å‰²æ–‡æ¡£</h3>
<p>ä½¿ç”¨ <code>RecursiveCharacterTextSplitter</code> å°†æ–‡æœ¬åˆ†å—ï¼Œä»¥ä¾¿åç»­è®¡ç®—æ–‡æœ¬å—çš„ Embeddingã€‚</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#57606a"># æ–‡æœ¬åˆ†å—</span>
</span></span><span style="display:flex;"><span>text_splitter <span style="color:#0550ae">=</span> RecursiveCharacterTextSplitter<span style="color:#1f2328">(</span>
</span></span><span style="display:flex;"><span>    chunk_size<span style="color:#0550ae">=</span><span style="color:#0550ae">1000</span><span style="color:#1f2328">,</span>  <span style="color:#57606a"># chunk size (characters)</span>
</span></span><span style="display:flex;"><span>    chunk_overlap<span style="color:#0550ae">=</span><span style="color:#0550ae">200</span><span style="color:#1f2328">,</span>  <span style="color:#57606a"># chunk overlap (characters)</span>
</span></span><span style="display:flex;"><span>    add_start_index<span style="color:#0550ae">=</span><span style="color:#cf222e">True</span><span style="color:#1f2328">,</span>  <span style="color:#57606a"># track index in original document</span>
</span></span><span style="display:flex;"><span><span style="color:#1f2328">)</span>
</span></span><span style="display:flex;"><span>all_splits <span style="color:#0550ae">=</span> text_splitter<span style="color:#0550ae">.</span>split_documents<span style="color:#1f2328">(</span>docs<span style="color:#1f2328">)</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#6639ba">print</span><span style="color:#1f2328">(</span><span style="color:#0a3069">f</span><span style="color:#0a3069">&#34;Split blog post into </span><span style="color:#0a3069">{</span><span style="color:#6639ba">len</span><span style="color:#1f2328">(</span>all_splits<span style="color:#1f2328">)</span><span style="color:#0a3069">}</span><span style="color:#0a3069"> sub-documents.&#34;</span><span style="color:#1f2328">)</span>
</span></span></code></pre></div><h3 id="3å‘é‡ç”Ÿæˆ">3ï¼‰å‘é‡ç”Ÿæˆ</h3>
<p>æ³¨æ„ï¼Œç”¨æˆ·é—®é¢˜ å’Œ çŸ¥è¯†åº“ å¿…é¡»ä½¿ç”¨åŒä¸€ä¸ª Embedding æ¨¡å‹æ¥ç”Ÿæˆå‘é‡ã€‚</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#57606a"># åˆå§‹åŒ–å‘é‡ç”Ÿæˆå™¨</span>
</span></span><span style="display:flex;"><span>embeddings <span style="color:#0550ae">=</span> DashScopeEmbeddings<span style="color:#1f2328">()</span>
</span></span></code></pre></div><h3 id="4å‘é‡å­˜å‚¨">4ï¼‰å‘é‡å­˜å‚¨</h3>
<p>è¿™é‡Œä»…ç”¨ <code>InMemoryVectorStore</code> åšæ¼”ç¤ºã€‚æ­£å¼é¡¹ç›®è¯·ç”¨ Chromaã€Milvus ç­‰å‘é‡æ•°æ®åº“ã€‚</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#57606a"># åˆå§‹åŒ–å†…å­˜å‘é‡å­˜å‚¨</span>
</span></span><span style="display:flex;"><span>vector_store <span style="color:#0550ae">=</span> InMemoryVectorStore<span style="color:#1f2328">(</span>embedding<span style="color:#0550ae">=</span>embeddings<span style="color:#1f2328">)</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#57606a"># å°†æ–‡æ¡£æ·»åŠ åˆ°å‘é‡å­˜å‚¨</span>
</span></span><span style="display:flex;"><span>document_ids <span style="color:#0550ae">=</span> vector_store<span style="color:#0550ae">.</span>add_documents<span style="color:#1f2328">(</span>documents<span style="color:#0550ae">=</span>all_splits<span style="color:#1f2328">)</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#6639ba">print</span><span style="color:#1f2328">(</span>document_ids<span style="color:#1f2328">[:</span><span style="color:#0550ae">2</span><span style="color:#1f2328">])</span>
</span></span></code></pre></div><h3 id="5åˆ›å»ºå·¥å…·">5ï¼‰åˆ›å»ºå·¥å…·</h3>
<p>åˆ›å»ºå¯è¢« Agent è°ƒç”¨çš„å·¥å…·ã€‚è¯¥å·¥å…·ä»å‘é‡å­˜å‚¨ä¸­å¬å› <code>k=2</code> ä¸ªä¸ <code>query</code> æœ€ç›¸ä¼¼çš„æ–‡æœ¬ç‰‡æ®µã€‚</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#57606a"># åˆ›å»ºä¸Šä¸‹æ–‡æ£€ç´¢å·¥å…·</span>
</span></span><span style="display:flex;"><span><span style="color:#0550ae">@tool</span><span style="color:#1f2328">(</span>response_format<span style="color:#0550ae">=</span><span style="color:#0a3069">&#34;content_and_artifact&#34;</span><span style="color:#1f2328">)</span>
</span></span><span style="display:flex;"><span><span style="color:#cf222e">def</span> <span style="color:#6639ba">retrieve_context</span><span style="color:#1f2328">(</span>query<span style="color:#1f2328">:</span> <span style="color:#6639ba">str</span><span style="color:#1f2328">):</span>
</span></span><span style="display:flex;"><span>    <span style="color:#0a3069">&#34;&#34;&#34;Retrieve information to help answer a query.&#34;&#34;&#34;</span>
</span></span><span style="display:flex;"><span>    retrieved_docs <span style="color:#0550ae">=</span> vector_store<span style="color:#0550ae">.</span>similarity_search<span style="color:#1f2328">(</span>query<span style="color:#1f2328">,</span> k<span style="color:#0550ae">=</span><span style="color:#0550ae">2</span><span style="color:#1f2328">)</span>
</span></span><span style="display:flex;"><span>    serialized <span style="color:#0550ae">=</span> <span style="color:#0a3069">&#34;</span><span style="color:#0a3069">\n\n</span><span style="color:#0a3069">&#34;</span><span style="color:#0550ae">.</span>join<span style="color:#1f2328">(</span>
</span></span><span style="display:flex;"><span>        <span style="color:#1f2328">(</span><span style="color:#0a3069">f</span><span style="color:#0a3069">&#34;Source: </span><span style="color:#0a3069">{</span>doc<span style="color:#0550ae">.</span>metadata<span style="color:#0a3069">}</span><span style="color:#0a3069">\n</span><span style="color:#0a3069">Content: </span><span style="color:#0a3069">{</span>doc<span style="color:#0550ae">.</span>page_content<span style="color:#0a3069">}</span><span style="color:#0a3069">&#34;</span><span style="color:#1f2328">)</span>
</span></span><span style="display:flex;"><span>        <span style="color:#cf222e">for</span> doc <span style="color:#0550ae">in</span> retrieved_docs
</span></span><span style="display:flex;"><span>    <span style="color:#1f2328">)</span>
</span></span><span style="display:flex;"><span>    <span style="color:#cf222e">return</span> serialized<span style="color:#1f2328">,</span> retrieved_docs
</span></span></code></pre></div><h3 id="6å¬å›æ–‡æœ¬">6ï¼‰å¬å›æ–‡æœ¬</h3>
<p>ä½¿ç”¨ Agent è°ƒç”¨æ£€ç´¢å·¥å…·ï¼Œå¬å›ä¸é—®é¢˜æœ‰å…³çš„ä¸Šä¸‹æ–‡ã€‚</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#57606a"># åˆ›å»º ReAct Agent</span>
</span></span><span style="display:flex;"><span>agent <span style="color:#0550ae">=</span> create_agent<span style="color:#1f2328">(</span>
</span></span><span style="display:flex;"><span>    llm<span style="color:#1f2328">,</span>
</span></span><span style="display:flex;"><span>    tools<span style="color:#0550ae">=</span><span style="color:#1f2328">[</span>retrieve_context<span style="color:#1f2328">],</span>
</span></span><span style="display:flex;"><span>    system_prompt<span style="color:#0550ae">=</span><span style="color:#1f2328">(</span>
</span></span><span style="display:flex;"><span>        <span style="color:#57606a"># If desired, specify custom instructions</span>
</span></span><span style="display:flex;"><span>        <span style="color:#0a3069">&#34;You have access to a tool that retrieves context from a blog post. &#34;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#0a3069">&#34;Use the tool to help answer user queries.&#34;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#1f2328">)</span>
</span></span><span style="display:flex;"><span><span style="color:#1f2328">)</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#57606a"># è°ƒç”¨ Agent</span>
</span></span><span style="display:flex;"><span>response <span style="color:#0550ae">=</span> agent<span style="color:#0550ae">.</span>invoke<span style="color:#1f2328">({</span>
</span></span><span style="display:flex;"><span>    <span style="color:#0a3069">&#34;messages&#34;</span><span style="color:#1f2328">:</span> <span style="color:#1f2328">[{</span><span style="color:#0a3069">&#34;role&#34;</span><span style="color:#1f2328">:</span> <span style="color:#0a3069">&#34;user&#34;</span><span style="color:#1f2328">,</span> <span style="color:#0a3069">&#34;content&#34;</span><span style="color:#1f2328">:</span> <span style="color:#0a3069">&#34;å½“å‰çš„ Agent èƒ½åŠ›æœ‰å“ªäº›å±€é™æ€§ï¼Ÿ&#34;</span><span style="color:#1f2328">}]</span>
</span></span><span style="display:flex;"><span><span style="color:#1f2328">})</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#57606a"># è·å– Agent çš„æœ€ç»ˆå›å¤</span>
</span></span><span style="display:flex;"><span>response<span style="color:#1f2328">[</span><span style="color:#0a3069">&#39;messages&#39;</span><span style="color:#1f2328">][</span><span style="color:#0550ae">-</span><span style="color:#0550ae">1</span><span style="color:#1f2328">]</span><span style="color:#0550ae">.</span>pretty_print<span style="color:#1f2328">()</span>
</span></span></code></pre></div><p>è¾“å‡ºç»“æœï¼š</p>
<pre tabindex="0"><code>==================================[1m Ai Message [0m==================================

å½“å‰çš„ Agent èƒ½åŠ›å­˜åœ¨ä»¥ä¸‹å‡ ä¸ªä¸»è¦å±€é™æ€§ï¼š

1. **é•¿æœŸè®°å¿†èƒ½åŠ›ä¸è¶³**ï¼š  
   Agent éš¾ä»¥æœ‰æ•ˆåœ°åŒºåˆ†å’Œä¿ç•™æœ‰ç”¨çš„å†å²å¯¹è¯ä¿¡æ¯ï¼ŒåŒæ—¶é—å¿˜æ— ç”¨å†…å®¹ã€‚æ­¤å¤–ï¼Œè¿˜ç¼ºä¹è·¨å¯¹è¯ç§¯ç´¯ç»éªŒã€æŒç»­æå‡é—®ç­”æ•ˆæœçš„èƒ½åŠ›ã€‚

2. **éªŒè¯ï¼ˆVerificationï¼‰èƒ½åŠ›ç¼ºå¤±**ï¼š  
   å³ä½¿å…·å¤‡ä¸€å®šçš„è®°å¿†èƒ½åŠ›ï¼ŒAgent ä»ç¼ºä¹å¯¹ä¿¡æ¯çœŸä¼ªæˆ–åˆç†æ€§çš„åˆ¤æ–­èƒ½åŠ›ã€‚å®ƒæ— æ³•è‡ªä¸»éªŒè¯æ‰€è·å–æˆ–ç”Ÿæˆçš„ä¿¡æ¯æ˜¯å¦å‡†ç¡®å¯é ã€‚

3. **çŸ¥è¯†ä½“ç³»æ„å»ºå›°éš¾**ï¼š  
   åœ¨æ²¡æœ‰è‰¯å¥½éªŒè¯æœºåˆ¶çš„å‰æä¸‹ï¼ŒAgent æ— æ³•å°†é›¶æ•£çš„è®°å¿†ç³»ç»ŸåŒ–åœ°åŠ å·¥æˆç»“æ„åŒ–çš„çŸ¥è¯†ä½“ç³»ï¼Œä»è€Œé™åˆ¶äº†å…¶æ¨ç†å’Œå†³ç­–èƒ½åŠ›ã€‚

è¿™äº›é—®é¢˜æ˜¯å½“å‰åŸºäº Agent æŠ€æœ¯çš„äº§å“ï¼ˆå¦‚ Quick BIã€TRAE ç­‰ï¼‰å…±åŒé¢ä¸´çš„ç“¶é¢ˆã€‚æœªæ¥éšç€ Agent æŠ€æœ¯åœ¨ä¸Šè¿°æ–¹å‘ä¸Šçš„çªç ´ï¼Œç›¸å…³åº”ç”¨ï¼ˆä¾‹å¦‚ ChatBIï¼‰çš„èƒ½åŠ›ä¹Ÿæœ‰æœ›æ˜¾è‘—æå‡ã€‚
</code></pre><h2 id="äº”å…³é”®è¯æ£€ç´¢">äº”ã€å…³é”®è¯æ£€ç´¢</h2>
<p><a href="https://en.wikipedia.org/wiki/Okapi_BM25">BM25</a> æ˜¯ä¸€ç§åŸºäºè¯é¢‘çš„æ’åºç®—æ³•ï¼Œå®ƒå¯ä»¥ä¼°è®¡æ–‡æ¡£ä¸ç»™å®šæŸ¥è¯¢çš„ç›¸å…³æ€§ã€‚ç»™å®šä¸€ä¸ªåŒ…å«å…³é”®è¯ $q_1, &hellip;, q_n$ çš„æŸ¥è¯¢ $Q$ï¼Œæ–‡æ¡£ $D$ çš„ BM25 åˆ†æ•°æ˜¯ï¼š</p>
<p>$$\text{score}(D, Q) = \sum_{i=1}^{n} \text{IDF}(q_i) \cdot \frac{f(q_i, D) \cdot (k_1 + 1)}{f(q_i, D) + k_1 \cdot \left( 1 - b + b \cdot \frac{|D|}{\text{avgdl}} \right)}$$</p>
<p>å…¶ä¸­ï¼š</p>
<ul>
<li>$f(q_i, D)$ï¼šå…³é”®è¯ $q_i$ åœ¨æ–‡æ¡£ $D$ ä¸­å‡ºç°çš„æ¬¡æ•°</li>
<li>$|D|$ï¼šæ–‡æ¡£ $D$ çš„è¯æ•°</li>
<li>$avgdl$ï¼šæ–‡æ¡£é›†åˆçš„å¹³å‡æ–‡æ¡£é•¿åº¦</li>
<li>$k_1$ï¼šå¯è°ƒå‚æ•°ï¼Œç”¨äºæ§åˆ¶è¯é¢‘é¥±å’Œåº¦ï¼Œé€šå¸¸é€‰æ‹©ä¸º $k_1 \in [1.2, 2.0]$</li>
<li>$b$ï¼šå¯è°ƒå‚æ•°ï¼Œç”¨äºæ§åˆ¶æ–‡æ¡£å½’ä¸€åŒ–ç¨‹åº¦ï¼Œé€šå¸¸é€‰æ‹©ä¸º $b = 0.75$</li>
<li>$\text{IDF}(q_i)$ï¼šå…³é”®è¯ $q_i$ çš„ IDFï¼ˆé€†æ–‡æ¡£é¢‘ç‡ï¼‰æƒé‡ï¼Œç”¨äºè¡¡é‡ä¸€ä¸ªè¯çš„æ™®éç¨‹åº¦ï¼Œè¶Šå¸¸è§çš„è¯å€¼è¶Šä½</li>
</ul>
<p>å¯¹äºä¸­æ–‡å…³é”®è¯æ£€ç´¢ï¼Œéœ€è¦å®‰è£…æ”¯æŒåˆ†è¯çš„ Python åŒ…ï¼š</p>
<h3 id="1åˆ›å»ºæ£€ç´¢å™¨">1ï¼‰åˆ›å»ºæ£€ç´¢å™¨</h3>
<p>æˆ‘ä»¬ä½¿ç”¨ LangChain æä¾›çš„ <a href="https://docs.langchain.com/oss/python/integrations/retrievers/bm25">BM25Retriever</a> åˆ›å»ºæ£€ç´¢å™¨ï¼Œå¹¶å°† jieba ä½œä¸ºå®ƒçš„åˆ†è¯å™¨ã€‚</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#cf222e">import</span> <span style="color:#24292e">jieba</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#cf222e">from</span> <span style="color:#24292e">langchain_community.retrievers</span> <span style="color:#cf222e">import</span> BM25Retriever
</span></span><span style="display:flex;"><span><span style="color:#cf222e">from</span> <span style="color:#24292e">langchain_core.documents</span> <span style="color:#cf222e">import</span> Document
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#cf222e">def</span> <span style="color:#6639ba">chinese_tokenize</span><span style="color:#1f2328">(</span>text<span style="color:#1f2328">:</span> <span style="color:#6639ba">str</span><span style="color:#1f2328">)</span> <span style="color:#0550ae">-&gt;</span> <span style="color:#6639ba">list</span><span style="color:#1f2328">[</span><span style="color:#6639ba">str</span><span style="color:#1f2328">]:</span>
</span></span><span style="display:flex;"><span>    <span style="color:#0a3069">&#34;&#34;&#34;ä¸­æ–‡åˆ†è¯å‡½æ•°&#34;&#34;&#34;</span>
</span></span><span style="display:flex;"><span>    tokens <span style="color:#0550ae">=</span> jieba<span style="color:#0550ae">.</span>lcut<span style="color:#1f2328">(</span>text<span style="color:#1f2328">)</span>
</span></span><span style="display:flex;"><span>    <span style="color:#cf222e">return</span> <span style="color:#1f2328">[</span>token <span style="color:#cf222e">for</span> token <span style="color:#0550ae">in</span> tokens <span style="color:#cf222e">if</span> token<span style="color:#0550ae">.</span>strip<span style="color:#1f2328">()]</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#57606a"># 1. ä½¿ç”¨æ–‡æœ¬åˆ›å»ºä¸­æ–‡æ£€ç´¢å™¨</span>
</span></span><span style="display:flex;"><span>text_retriever <span style="color:#0550ae">=</span> BM25Retriever<span style="color:#0550ae">.</span>from_texts<span style="color:#1f2328">(</span>
</span></span><span style="display:flex;"><span>    <span style="color:#1f2328">[</span>
</span></span><span style="display:flex;"><span>        <span style="color:#0a3069">&#34;ä½•æ„å‘³&#34;</span><span style="color:#1f2328">,</span>
</span></span><span style="display:flex;"><span>        <span style="color:#0a3069">&#34;é‚£å¾ˆåäº†&#34;</span><span style="color:#1f2328">,</span>
</span></span><span style="display:flex;"><span>        <span style="color:#0a3069">&#34;è¿™ç‚¹å°äº‹ä¹Ÿæ— æ‰€è°“å§&#34;</span><span style="color:#1f2328">,</span>
</span></span><span style="display:flex;"><span>        <span style="color:#0a3069">&#34;æˆ‘æ›¿å¥¹åŸè°…ä½ äº†&#34;</span><span style="color:#1f2328">,</span>
</span></span><span style="display:flex;"><span>    <span style="color:#1f2328">],</span>
</span></span><span style="display:flex;"><span>    k<span style="color:#0550ae">=</span><span style="color:#0550ae">2</span><span style="color:#1f2328">,</span>
</span></span><span style="display:flex;"><span>    preprocess_func<span style="color:#0550ae">=</span>chinese_tokenize<span style="color:#1f2328">,</span>
</span></span><span style="display:flex;"><span><span style="color:#1f2328">)</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#57606a"># 2. ä½¿ç”¨æ–‡æ¡£åˆ›å»ºä¸­æ–‡æ£€ç´¢å™¨</span>
</span></span><span style="display:flex;"><span>doc_retriever <span style="color:#0550ae">=</span> BM25Retriever<span style="color:#0550ae">.</span>from_documents<span style="color:#1f2328">(</span>
</span></span><span style="display:flex;"><span>    <span style="color:#1f2328">[</span>
</span></span><span style="display:flex;"><span>        Document<span style="color:#1f2328">(</span>page_content<span style="color:#0550ae">=</span><span style="color:#0a3069">&#34;è¾£æ¤’ç‚’è‚‰æ‹Œé¢&#34;</span><span style="color:#1f2328">),</span>
</span></span><span style="display:flex;"><span>        Document<span style="color:#1f2328">(</span>page_content<span style="color:#0550ae">=</span><span style="color:#0a3069">&#34;è‚‰è›‹è‘±é¸¡&#34;</span><span style="color:#1f2328">),</span>
</span></span><span style="display:flex;"><span>        Document<span style="color:#1f2328">(</span>page_content<span style="color:#0550ae">=</span><span style="color:#0a3069">&#34;è¿™ä¸‹ä¸ç†Ÿäº†&#34;</span><span style="color:#1f2328">),</span>
</span></span><span style="display:flex;"><span>        Document<span style="color:#1f2328">(</span>page_content<span style="color:#0550ae">=</span><span style="color:#0a3069">&#34;é“ä¸²å­&#34;</span><span style="color:#1f2328">),</span>
</span></span><span style="display:flex;"><span>    <span style="color:#1f2328">],</span>
</span></span><span style="display:flex;"><span>    k<span style="color:#0550ae">=</span><span style="color:#0550ae">2</span><span style="color:#1f2328">,</span>
</span></span><span style="display:flex;"><span>    preprocess_func<span style="color:#0550ae">=</span>chinese_tokenize<span style="color:#1f2328">,</span>
</span></span><span style="display:flex;"><span><span style="color:#1f2328">)</span>
</span></span></code></pre></div><h3 id="2ä½¿ç”¨æ£€ç´¢å™¨">2ï¼‰ä½¿ç”¨æ£€ç´¢å™¨</h3>
<p>æ£€ç´¢æ–‡æœ¬ï¼š</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>text_retriever<span style="color:#0550ae">.</span>invoke<span style="color:#1f2328">(</span><span style="color:#0a3069">&#34;ä¸€ä»¶å°äº‹&#34;</span><span style="color:#1f2328">)</span>
</span></span></code></pre></div><p>è¾“å‡ºç»“æœï¼š</p>
<pre tabindex="0"><code>[Document(metadata={}, page_content=&#39;è¿™ç‚¹å°äº‹ä¹Ÿæ— æ‰€è°“å§&#39;),
 Document(metadata={}, page_content=&#39;æˆ‘æ›¿å¥¹åŸè°…ä½ äº†&#39;)]
</code></pre><p>æ£€ç´¢æ–‡æ¡£ï¼š</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>doc_retriever<span style="color:#0550ae">.</span>invoke<span style="color:#1f2328">(</span><span style="color:#0a3069">&#34;æ‹Œé¢&#34;</span><span style="color:#1f2328">)</span>
</span></span></code></pre></div><p>è¾“å‡ºç»“æœï¼š</p>
<pre tabindex="0"><code>[Document(metadata={}, page_content=&#39;è¾£æ¤’ç‚’è‚‰æ‹Œé¢&#39;),
 Document(metadata={}, page_content=&#39;é“ä¸²å­&#39;)]
</code></pre><h2 id="å…­æ··åˆæ£€ç´¢">å…­ã€æ··åˆæ£€ç´¢</h2>
<p>å‘é‡æ£€ç´¢å’Œå…³é”®è¯æ£€ç´¢å„æ“…èƒœåœºã€‚å‘é‡æ£€ç´¢æ“…é•¿è¯­ä¹‰åŒ¹é…ï¼Œå…³é”®è¯æ£€ç´¢æ“…é•¿ç²¾ç¡®åŒ¹é…ï¼Œä¸¤è€…å¯ä»¥å½¢æˆäº’è¡¥ã€‚å› æ­¤ï¼Œå·¥ä¸šç•Œçš„ RAG ç³»ç»Ÿå¸¸ç”¨ <strong>å‘é‡æ£€ç´¢ + å…³é”®è¯æ£€ç´¢</strong> çš„æ··åˆæ£€ç´¢æ–¹æ¡ˆã€‚è¿™ç›¸å½“äºæœ‰ä¸¤è·¯å¬å›ï¼Œæ··åˆæ£€ç´¢çš„å…³é”®åœ¨äºå¦‚ä½•å¯¹ä¸¤è·¯å¬å›çš„ç»“æœè¿›è¡Œç­›é€‰å’Œé‡æ’ï¼ˆRerankï¼‰ã€‚</p>
<h3 id="1rrf-åˆ†æ•°">1ï¼‰RRF åˆ†æ•°</h3>
<p><strong>RRF</strong>ï¼ˆReciprocal Rank Fusion, å€’æ•°æ’åºèåˆï¼‰æ˜¯ä¸€ç§ç»å…¸çš„é‡æ’æ–¹æ¡ˆã€‚ä½ å¯ä»¥ä½¿ç”¨ RRF é›†æˆå¤šä¸ªæ£€ç´¢å™¨åˆ†æ•°ï¼Œä»¥è®¡ç®—æ–‡æœ¬ç‰‡æ®µçš„æœ€ç»ˆæ’åã€‚</p>
<p>ä¸€ä¸ªæ–‡æœ¬ç‰‡æ®µçš„ RRF åˆ†æ•°å¯ç”±ä»¥ä¸‹å…¬å¼è®¡ç®—å¾—å‡ºï¼š</p>
<p>$$\text{RRF} = \sum_{i} \frac{w_i}{k + r_i}$$</p>
<p>å…¶ä¸­ï¼š</p>
<ul>
<li>$w_i$ï¼šç¬¬ $i$ ä¸ªæ£€ç´¢å™¨çš„æƒé‡ï¼Œé»˜è®¤å€¼ä¸º $1.0$</li>
<li>$k$ï¼šå¹³æ»‘å‚æ•°ï¼Œé»˜è®¤å€¼ä¸º $60$</li>
<li>$r_i$ï¼šæ–‡æ¡£åœ¨ç¬¬ $i$ ä¸ªæ£€ç´¢å™¨ä¸­çš„æ’å</li>
</ul>
<p>åŸºäº RRF åˆ†æ•°çš„æ··åˆæ£€ç´¢å¯ä»¥é€šè¿‡å‘é‡æ•°æ®åº“å®ç°ï¼Œè¯¦æƒ…å‚è§æ–‡æ¡£ï¼Œè¿™é‡Œä¸å†èµ˜è¿°äº†ï¼š</p>
<ul>
<li><a href="https://milvus.io/docs/multi-vector-search.md">Milvus</a></li>
<li><a href="https://docs.trychroma.com/cloud/search-api/hybrid-search">Chroma</a></li>
</ul>
<h3 id="2agentic-hybrid-search">2ï¼‰Agentic Hybrid Search</h3>
<p>æ ¹æ®ç¬¬ä¸€æ€§åŸç†ï¼Œè‹¥ç”¨å¤§æ¨¡å‹å¯ä»¥è·å¾—æ›´å¥½çš„é‡æ’æ•ˆæœï¼Œä½•é¡»è®¡ç®— RRF åˆ†æ•°ã€‚ä¸‹é¢æˆ‘ä»¬å†™ä¸€æ®µå®éªŒä»£ç ï¼ŒéªŒè¯ä¸€ä¸‹ç”¨å¤§æ¨¡å‹åšé‡æ’çš„æ•ˆæœã€‚</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#cf222e">import</span> <span style="color:#24292e">random</span>
</span></span><span style="display:flex;"><span><span style="color:#cf222e">from</span> <span style="color:#24292e">typing</span> <span style="color:#cf222e">import</span> List
</span></span><span style="display:flex;"><span><span style="color:#cf222e">from</span> <span style="color:#24292e">pydantic</span> <span style="color:#cf222e">import</span> BaseModel<span style="color:#1f2328">,</span> Field
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#57606a"># è¿™æ˜¯ç”¨æˆ· query</span>
</span></span><span style="display:flex;"><span>query <span style="color:#0550ae">=</span> <span style="color:#0a3069">&#34;ç›˜ç‚¹æµ·ç­çš„é»‘å†å²&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#57606a"># è¿™æ˜¯ å‘é‡æ£€ç´¢ å¬å›çš„æ–‡æœ¬ç‰‡æ®µ</span>
</span></span><span style="display:flex;"><span>dense_texts <span style="color:#0550ae">=</span> <span style="color:#1f2328">[</span>
</span></span><span style="display:flex;"><span>    <span style="color:#0a3069">&#34;æŸäº›æµ·æ´‹ç”Ÿç‰©ä¼šä¹±æ‰”åƒåœ¾&#34;</span><span style="color:#1f2328">,</span>
</span></span><span style="display:flex;"><span>    <span style="color:#0a3069">&#34;æµ·ç­å¤ªå¯çˆ±äº†&#34;</span><span style="color:#1f2328">,</span>
</span></span><span style="display:flex;"><span>    <span style="color:#0a3069">&#34;æµ·ç­è‡­è‡­çš„&#34;</span><span style="color:#1f2328">,</span>
</span></span><span style="display:flex;"><span><span style="color:#1f2328">]</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#57606a"># è¿™æ˜¯ å…³é”®è¯æ£€ç´¢ å¬å›çš„æ–‡æœ¬ç‰‡æ®µ</span>
</span></span><span style="display:flex;"><span>sparse_texts <span style="color:#0550ae">=</span> <span style="color:#1f2328">[</span>
</span></span><span style="display:flex;"><span>    <span style="color:#0a3069">&#34;æµ·ç­è‡­è‡­çš„&#34;</span><span style="color:#1f2328">,</span>
</span></span><span style="display:flex;"><span>    <span style="color:#0a3069">&#34;é›ªé¸®çš„é»‘å†å²&#34;</span><span style="color:#1f2328">,</span>
</span></span><span style="display:flex;"><span><span style="color:#1f2328">]</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#57606a"># å®šä¹‰ Agent è¾“å‡ºæ ¼å¼</span>
</span></span><span style="display:flex;"><span><span style="color:#cf222e">class</span> <span style="color:#1f2328">ReRankOutput</span><span style="color:#1f2328">(</span>BaseModel<span style="color:#1f2328">):</span>
</span></span><span style="display:flex;"><span>    indices<span style="color:#1f2328">:</span> List<span style="color:#1f2328">[</span><span style="color:#6639ba">int</span><span style="color:#1f2328">]</span> <span style="color:#0550ae">=</span> Field<span style="color:#1f2328">(</span>description<span style="color:#0550ae">=</span><span style="color:#0a3069">&#34;é‡æ’åçš„å¬å›æ–‡æœ¬ç‰‡æ®µçš„ç´¢å¼•åˆ—è¡¨&#34;</span><span style="color:#1f2328">)</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#57606a"># è¿”å›æœ€å¤š limit ä¸ªæ–‡æœ¬ç‰‡æ®µ</span>
</span></span><span style="display:flex;"><span><span style="color:#cf222e">def</span> <span style="color:#6639ba">get_relevant_texts</span><span style="color:#1f2328">(</span>query<span style="color:#1f2328">:</span> <span style="color:#6639ba">str</span><span style="color:#1f2328">,</span>
</span></span><span style="display:flex;"><span>                     dense_texts<span style="color:#1f2328">:</span> <span style="color:#6639ba">list</span><span style="color:#1f2328">,</span>
</span></span><span style="display:flex;"><span>                     sparse_texts<span style="color:#1f2328">:</span> <span style="color:#6639ba">list</span><span style="color:#1f2328">,</span>
</span></span><span style="display:flex;"><span>                     limit<span style="color:#1f2328">:</span> <span style="color:#6639ba">int</span> <span style="color:#0550ae">=</span> <span style="color:#0550ae">3</span><span style="color:#1f2328">):</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#57606a"># åˆ›å»ºä¸Šä¸‹æ–‡</span>
</span></span><span style="display:flex;"><span>    texts <span style="color:#0550ae">=</span> dense_texts <span style="color:#0550ae">+</span> sparse_texts
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#57606a"># å»é‡</span>
</span></span><span style="display:flex;"><span>    texts <span style="color:#0550ae">=</span> <span style="color:#6639ba">list</span><span style="color:#1f2328">(</span><span style="color:#6639ba">set</span><span style="color:#1f2328">(</span>texts<span style="color:#1f2328">))</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#57606a"># æ‰“ä¹±å…ƒç´ é¡ºåºï¼Œæ¶ˆé™¤ç”±ä½ç½®å¼•å…¥çš„ bias</span>
</span></span><span style="display:flex;"><span>    random<span style="color:#0550ae">.</span>shuffle<span style="color:#1f2328">(</span>texts<span style="color:#1f2328">)</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#57606a"># å°†ç´¢å¼• id æ˜¾å¼æ·»åŠ åˆ°æ–‡æœ¬ç‰‡æ®µå‰</span>
</span></span><span style="display:flex;"><span>    texts_with_index <span style="color:#0550ae">=</span> <span style="color:#1f2328">[</span><span style="color:#0a3069">f</span><span style="color:#0a3069">&#34;</span><span style="color:#0a3069">{</span>i<span style="color:#0a3069">}</span><span style="color:#0a3069"> - </span><span style="color:#0a3069">{</span>text<span style="color:#0a3069">}</span><span style="color:#0a3069">&#34;</span> <span style="color:#cf222e">for</span> i<span style="color:#1f2328">,</span> text <span style="color:#0550ae">in</span> <span style="color:#6639ba">enumerate</span><span style="color:#1f2328">(</span>texts<span style="color:#1f2328">)]</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    context <span style="color:#0550ae">=</span> <span style="color:#0a3069">&#39;</span><span style="color:#0a3069">\n\n</span><span style="color:#0a3069">&#39;</span><span style="color:#0550ae">.</span>join<span style="color:#1f2328">(</span>texts_with_index<span style="color:#1f2328">)</span>
</span></span><span style="display:flex;"><span>    prompt <span style="color:#0550ae">=</span> <span style="color:#0a3069">&#34;</span><span style="color:#0a3069">\n</span><span style="color:#0a3069">&#34;</span><span style="color:#0550ae">.</span>join<span style="color:#1f2328">([</span>
</span></span><span style="display:flex;"><span>        <span style="color:#0a3069">f</span><span style="color:#0a3069">&#34;</span><span style="color:#0a3069">{</span>context<span style="color:#0a3069">}</span><span style="color:#0a3069">&#34;</span><span style="color:#1f2328">,</span>
</span></span><span style="display:flex;"><span>        <span style="color:#0a3069">&#34;---&#34;</span><span style="color:#1f2328">,</span>
</span></span><span style="display:flex;"><span>        <span style="color:#0a3069">&#34;ä¸Šé¢æ˜¯RAGå¬å›çš„å¤šä¸ªæ–‡æœ¬ç‰‡æ®µã€‚æ¯ä¸ªæ–‡æœ¬ç‰‡æ®µçš„æ ¼å¼ä¸º [ç´¢å¼•] - [å†…å®¹]ã€‚&#34;</span><span style="color:#1f2328">,</span>
</span></span><span style="display:flex;"><span>        <span style="color:#0a3069">f</span><span style="color:#0a3069">&#34;è¯·è¿”å›æœ€å¤š</span><span style="color:#0a3069">{</span>limit<span style="color:#0a3069">}</span><span style="color:#0a3069">ä¸ªä¸ç”¨æˆ·é—®é¢˜æœ‰å…³çš„æ–‡æœ¬ç‰‡æ®µçš„ç´¢å¼•ï¼ˆè‹¥ç›¸å…³æ€§å†…å®¹ä¸è¶³ï¼Œå…è®¸å°‘äº</span><span style="color:#0a3069">{</span>limit<span style="color:#0a3069">}</span><span style="color:#0a3069">æ¡ï¼‰ã€‚&#34;</span><span style="color:#1f2328">,</span>
</span></span><span style="display:flex;"><span>        <span style="color:#0a3069">&#34;</span><span style="color:#0a3069">\n</span><span style="color:#0a3069">æ³¨æ„äº‹é¡¹ï¼š&#34;</span><span style="color:#1f2328">,</span>
</span></span><span style="display:flex;"><span>        <span style="color:#0a3069">&#34;1. ç›¸å…³æ€§æ›´é«˜çš„æ–‡æœ¬ç‰‡æ®µåº”è¯¥æ’åœ¨å‰é¢&#34;</span><span style="color:#1f2328">,</span>
</span></span><span style="display:flex;"><span>        <span style="color:#0a3069">&#34;2. è¿”å›çš„æ–‡æœ¬ç‰‡æ®µå¿…é¡»æœ‰åŠ©äºå›ç­”ç”¨æˆ·é—®é¢˜ï¼&#34;</span><span style="color:#1f2328">,</span>
</span></span><span style="display:flex;"><span>        <span style="color:#0a3069">f</span><span style="color:#0a3069">&#34;</span><span style="color:#0a3069">\n</span><span style="color:#0a3069">ç”¨æˆ·é—®é¢˜ï¼š</span><span style="color:#0a3069">{</span>query<span style="color:#0a3069">}</span><span style="color:#0a3069">&#34;</span><span style="color:#1f2328">,</span>
</span></span><span style="display:flex;"><span>        <span style="color:#0a3069">&#34;æ–‡æœ¬ç‰‡æ®µçš„ç´¢å¼•åˆ—è¡¨ï¼š&#34;</span><span style="color:#1f2328">,</span>
</span></span><span style="display:flex;"><span>    <span style="color:#1f2328">])</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#57606a"># åˆ›å»ºå¸¦ç»“æ„åŒ–è¾“å‡ºçš„Agent</span>
</span></span><span style="display:flex;"><span>    agent <span style="color:#0550ae">=</span> create_agent<span style="color:#1f2328">(</span>
</span></span><span style="display:flex;"><span>        model<span style="color:#0550ae">=</span>llm<span style="color:#1f2328">,</span>
</span></span><span style="display:flex;"><span>        system_prompt<span style="color:#0550ae">=</span><span style="color:#0a3069">&#34;ä½ æ˜¯ä¸€ä¸ªå¬å›æ–‡æœ¬ç›¸å…³æ€§é‡æ’åŠ©æ‰‹&#34;</span><span style="color:#1f2328">,</span>
</span></span><span style="display:flex;"><span>        response_format<span style="color:#0550ae">=</span>ReRankOutput<span style="color:#1f2328">,</span>
</span></span><span style="display:flex;"><span>    <span style="color:#1f2328">)</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#57606a"># è°ƒç”¨ Agent</span>
</span></span><span style="display:flex;"><span>    result <span style="color:#0550ae">=</span> agent<span style="color:#0550ae">.</span>invoke<span style="color:#1f2328">(</span>
</span></span><span style="display:flex;"><span>        <span style="color:#1f2328">{</span><span style="color:#0a3069">&#34;messages&#34;</span><span style="color:#1f2328">:</span> <span style="color:#1f2328">[{</span><span style="color:#0a3069">&#34;role&#34;</span><span style="color:#1f2328">:</span> <span style="color:#0a3069">&#34;user&#34;</span><span style="color:#1f2328">,</span> <span style="color:#0a3069">&#34;content&#34;</span><span style="color:#1f2328">:</span> prompt<span style="color:#1f2328">}]},</span>
</span></span><span style="display:flex;"><span>    <span style="color:#1f2328">)</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    indices <span style="color:#0550ae">=</span> result<span style="color:#1f2328">[</span><span style="color:#0a3069">&#39;structured_response&#39;</span><span style="color:#1f2328">]</span><span style="color:#0550ae">.</span>indices
</span></span><span style="display:flex;"><span>    <span style="color:#cf222e">return</span> <span style="color:#1f2328">[</span>texts<span style="color:#1f2328">[</span>i<span style="color:#1f2328">]</span> <span style="color:#cf222e">for</span> i <span style="color:#0550ae">in</span> indices<span style="color:#1f2328">]</span>
</span></span></code></pre></div><p>è°ƒç”¨å¬å›æ–‡æœ¬ç›¸å…³æ€§é‡æ’åŠ©æ‰‹ï¼Œè·å–é‡æ’åçš„ç›¸å…³æ€§æ–‡æœ¬åˆ—è¡¨ã€‚</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>res <span style="color:#0550ae">=</span> get_relevant_texts<span style="color:#1f2328">(</span>
</span></span><span style="display:flex;"><span>    query<span style="color:#1f2328">,</span>
</span></span><span style="display:flex;"><span>    dense_texts<span style="color:#1f2328">,</span>
</span></span><span style="display:flex;"><span>    sparse_texts<span style="color:#1f2328">,</span>
</span></span><span style="display:flex;"><span><span style="color:#1f2328">)</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>res
</span></span></code></pre></div><p>è¾“å‡ºç»“æœï¼š</p>
<pre tabindex="0"><code>[&#39;æµ·ç­è‡­è‡­çš„&#39;, &#39;æµ·ç­å¤ªå¯çˆ±äº†&#39;]
</code></pre><h2 id="ä¸ƒrag-æ¶æ„">ä¸ƒã€RAG æ¶æ„</h2>
<p>RAG æœ‰ä¸‰ç§ä¸»æµæ¶æ„ï¼š</p>
<table>
  <thead>
      <tr>
          <th>æ¶æ„</th>
          <th>æè¿°</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td>2-Step RAG</td>
          <td>å…ˆæ£€ç´¢ï¼Œå†ç”Ÿæˆ</td>
      </tr>
      <tr>
          <td>Agentic RAG</td>
          <td>ä½¿ç”¨ Agent æ§åˆ¶æ£€ç´¢çš„æ—¶æœºä¸æ–¹å¼</td>
      </tr>
      <tr>
          <td>Hybrid RAG</td>
          <td>åœ¨ Agentic RAG çš„åŸºç¡€ä¸Šï¼Œå¢åŠ ç”¨æˆ· query æ”¹å†™ï¼Œç¡®è®¤å¬å›æ–‡æœ¬çš„ç›¸å…³æ€§ç­‰æ­¥éª¤</td>
      </tr>
  </tbody>
</table>
<blockquote>
<p><strong>Note</strong>
å®˜æ–¹æ–‡æ¡£çš„ <a href="https://docs.langchain.com/oss/python/langchain/retrieval#rag-architectures">æ¶æ„éƒ¨åˆ†</a>  å†™å¾—å¾ˆå¥½ï¼Œæ¨èé˜…è¯»ã€‚</p></blockquote>
<h3 id="12-step-rag">1ï¼‰2-Step RAG</h3>
<p><img src="/img/2-step-rag.png" alt="2-step-rag"></p>
<h3 id="2agentic-rag">2ï¼‰Agentic RAG</h3>
<p><img src="/img/agentic-rag.png" alt="agentic-rag"></p>
<h3 id="3hybrid-rag">3ï¼‰Hybrid RAG</h3>
<p><img src="/img/hybrid-rag.png" alt="hybrid-rag"></p>
<h2 id="å…«ç½‘ç»œæœç´¢">å…«ã€ç½‘ç»œæœç´¢</h2>
<p>ç½‘ç»œæœç´¢æœ¬èº«æ˜¯ä¸€ä¸ªå¾ˆé‡çš„æœåŠ¡ï¼Œå®ƒåŒ…å«ä¸‰é¡¹æ ¸å¿ƒä»»åŠ¡ï¼šç½‘é¡µçˆ¬å–ã€ç½‘é¡µç´¢å¼•å’Œç½‘é¡µæ£€ç´¢ã€‚<strong>ç½‘é¡µç´¢å¼•</strong> å‡ ä¹åªèƒ½ç”±å¤§å…¬å¸å®Œæˆã€‚å³ä½¿ <a href="https://github.com/searxng/searxng">SearXNG</a> è¿™æ ·çš„å¼€æºæ£€ç´¢æ–¹æ¡ˆï¼Œä¹Ÿåªæ˜¯èšåˆç¬¬ä¸‰æ–¹æœç´¢å¼•æ“ï¼ˆå¦‚å¿…åº”ã€æœç‹—ï¼‰çš„ç»“æœï¼Œæ²¡æœ‰ç‹¬ç«‹ç´¢å¼•èƒ½åŠ›ã€‚å› æ­¤ï¼Œå³ä½¿ç‹¬ç«‹å¼€å‘ç½‘ç»œæœç´¢åŠŸèƒ½ï¼Œä¹Ÿéš¾ä»¥ç»•å¼€å¤§å…¬å¸çš„æœåŠ¡ã€‚ä¸å¦‚ä¸€å¼€å§‹å°±è€è€å®å®ç”¨å¤§å…¬å¸çš„ APIï¼Œæ¥è·å–æœç´¢ç»“æœã€‚</p>
<p>ä¸‹é¢å±•ç¤ºä½¿ç”¨ <a href="https://dashscope.aliyun.com/">DashScope</a> è”ç½‘æœç´¢çš„æ–¹æ³•å’Œæ•ˆæœã€‚</p>
<p>é¦–å…ˆå®‰è£… dashscopeï¼š</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>pip install dashscope
</span></span></code></pre></div><p>åªéœ€è¦å°† <code>Generation.call</code> å‡½æ•°çš„ç½‘ç»œå‚æ•° <code>enable_search</code> è®¾ä¸º <code>True</code> å°±èƒ½æ¥å…¥äº’è”ç½‘ã€‚ä¸‹é¢æŠŠè¿™ä¸ªå‡½æ•°åšæˆå·¥å…·ä¾› Agent è°ƒç”¨ã€‚</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#cf222e">from</span> <span style="color:#24292e">dashscope</span> <span style="color:#cf222e">import</span> Generation
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#0550ae">@tool</span>
</span></span><span style="display:flex;"><span><span style="color:#cf222e">def</span> <span style="color:#6639ba">dashscope_search</span><span style="color:#1f2328">(</span>query<span style="color:#1f2328">:</span> <span style="color:#6639ba">str</span><span style="color:#1f2328">)</span> <span style="color:#0550ae">-&gt;</span> <span style="color:#6639ba">str</span><span style="color:#1f2328">:</span>
</span></span><span style="display:flex;"><span>    <span style="color:#0a3069">&#34;&#34;&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#0a3069">    ä½¿ç”¨å¤¸å…‹æœç´¢ API æœç´¢äº’è”ç½‘ä¿¡æ¯ã€‚
</span></span></span><span style="display:flex;"><span><span style="color:#0a3069">    &#34;&#34;&#34;</span>
</span></span><span style="display:flex;"><span>    response <span style="color:#0550ae">=</span> Generation<span style="color:#0550ae">.</span>call<span style="color:#1f2328">(</span>
</span></span><span style="display:flex;"><span>        model<span style="color:#0550ae">=</span><span style="color:#0a3069">&#39;qwen3-max&#39;</span><span style="color:#1f2328">,</span>
</span></span><span style="display:flex;"><span>        prompt<span style="color:#0550ae">=</span>query<span style="color:#1f2328">,</span>
</span></span><span style="display:flex;"><span>        enable_search<span style="color:#0550ae">=</span><span style="color:#cf222e">True</span><span style="color:#1f2328">,</span>
</span></span><span style="display:flex;"><span>        result_format<span style="color:#0550ae">=</span><span style="color:#0a3069">&#39;message&#39;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#1f2328">)</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#cf222e">if</span> response<span style="color:#0550ae">.</span>status_code <span style="color:#0550ae">==</span> <span style="color:#0550ae">200</span><span style="color:#1f2328">:</span>
</span></span><span style="display:flex;"><span>        <span style="color:#cf222e">return</span> response<span style="color:#0550ae">.</span>output<span style="color:#0550ae">.</span>choices<span style="color:#1f2328">[</span><span style="color:#0550ae">0</span><span style="color:#1f2328">]</span><span style="color:#0550ae">.</span>message<span style="color:#0550ae">.</span>content
</span></span><span style="display:flex;"><span>    <span style="color:#cf222e">else</span><span style="color:#1f2328">:</span>
</span></span><span style="display:flex;"><span>        <span style="color:#cf222e">return</span> <span style="color:#1f2328">(</span>
</span></span><span style="display:flex;"><span>            <span style="color:#0a3069">&#34;Search failed with status code: &#34;</span>
</span></span><span style="display:flex;"><span>            <span style="color:#0a3069">f</span><span style="color:#0a3069">&#34;</span><span style="color:#0a3069">{</span>response<span style="color:#0550ae">.</span>status_code<span style="color:#0a3069">}</span><span style="color:#0a3069">, message: </span><span style="color:#0a3069">{</span>response<span style="color:#0550ae">.</span>message<span style="color:#0a3069">}</span><span style="color:#0a3069">&#34;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#1f2328">)</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#57606a"># åˆ›å»º Agent</span>
</span></span><span style="display:flex;"><span>agent <span style="color:#0550ae">=</span> create_agent<span style="color:#1f2328">(</span>
</span></span><span style="display:flex;"><span>    model<span style="color:#0550ae">=</span>llm<span style="color:#1f2328">,</span>
</span></span><span style="display:flex;"><span>    tools<span style="color:#0550ae">=</span><span style="color:#1f2328">[</span>dashscope_search<span style="color:#1f2328">],</span>
</span></span><span style="display:flex;"><span>    system_prompt<span style="color:#0550ae">=</span><span style="color:#0a3069">&#34;ä½ æ˜¯ä¸€ä¸ªæ™ºèƒ½åŠ©æ‰‹ï¼Œå›ç­”å‰å¿…é¡»ä½¿ç”¨å·¥å…·æœç´¢äº’è”ç½‘ä¿¡æ¯&#34;</span><span style="color:#1f2328">,</span>
</span></span><span style="display:flex;"><span><span style="color:#1f2328">)</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#57606a"># è¿è¡Œ Agent</span>
</span></span><span style="display:flex;"><span>response <span style="color:#0550ae">=</span> agent<span style="color:#0550ae">.</span>invoke<span style="color:#1f2328">(</span>
</span></span><span style="display:flex;"><span>    <span style="color:#1f2328">{</span><span style="color:#0a3069">&#34;messages&#34;</span><span style="color:#1f2328">:</span> <span style="color:#1f2328">[{</span>
</span></span><span style="display:flex;"><span>        <span style="color:#0a3069">&#34;role&#34;</span><span style="color:#1f2328">:</span> <span style="color:#0a3069">&#34;user&#34;</span><span style="color:#1f2328">,</span>
</span></span><span style="display:flex;"><span>        <span style="color:#0a3069">&#34;content&#34;</span><span style="color:#1f2328">:</span> <span style="color:#0a3069">&#34;å‘Šè¯‰æˆ‘ä»Šå¤©çš„æ—¥æœŸï¼Œä»¥åŠä»Šå¤©æœ€é‡è¦çš„ä¸€æ¡æ–°é—»&#34;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#1f2328">}]}</span>
</span></span><span style="display:flex;"><span><span style="color:#1f2328">)</span>
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#57606a"># è·å– Agent çš„å…¨éƒ¨å›å¤</span>
</span></span><span style="display:flex;"><span><span style="color:#cf222e">for</span> message <span style="color:#0550ae">in</span> response<span style="color:#1f2328">[</span><span style="color:#0a3069">&#39;messages&#39;</span><span style="color:#1f2328">]:</span>
</span></span><span style="display:flex;"><span>    message<span style="color:#0550ae">.</span>pretty_print<span style="color:#1f2328">()</span>
</span></span></code></pre></div><p>è¾“å‡ºç»“æœï¼š</p>
<pre tabindex="0"><code>================================ Human Message =================================

å‘Šè¯‰æˆ‘ä»Šå¤©çš„æ—¥æœŸï¼Œä»¥åŠä»Šå¤©æœ€é‡è¦çš„ä¸€æ¡æ–°é—»
================================== Ai Message ==================================
Tool Calls:
  dashscope_search (call_0d753c0e020d457f9309a5)
 Call ID: call_0d753c0e020d457f9309a5
  Args:
    query: ä»Šå¤©çš„æ—¥æœŸ
  dashscope_search (call_d714a572adba4037b921eb)
 Call ID: call_d714a572adba4037b921eb
  Args:
    query: ä»Šå¤©æœ€é‡è¦çš„ä¸€æ¡æ–°é—»
================================= Tool Message =================================
Name: dashscope_search

ä»Šå¤©çš„æ—¥æœŸæ˜¯ï¼š**2025å¹´12æœˆ28æ—¥ï¼Œæ˜ŸæœŸæ—¥**ã€‚
================================= Tool Message =================================
Name: dashscope_search

æˆªè‡³**2025å¹´12æœˆ28æ—¥**ï¼Œä»Šå¤©æœ€é‡è¦çš„ä¸€æ¡æ–°é—»æ˜¯ï¼š

### **ç¾å›½å®£å¸ƒå°†å¯¹ä¸­å›½éƒ¨åˆ†åŠå¯¼ä½“äº§å“åŠ å¾301å…³ç¨ï¼Œä½†è®¾ç½®18ä¸ªæœˆç¼“å†²æœŸï¼ˆè‡³2027å¹´6æœˆï¼‰**

#### æ ¸å¿ƒè¦ç‚¹ï¼š
- **äº‹ä»¶èƒŒæ™¯**ï¼šç¾ä¸œæ—¶é—´12æœˆ23æ—¥ï¼Œç¾å›½è´¸æ˜“ä»£è¡¨åŠå…¬å®¤å‘å¸ƒé’ˆå¯¹ä¸­å›½åŠå¯¼ä½“æ”¿ç­–çš„â€œ301è°ƒæŸ¥â€ç»“æœï¼Œè®¤å®šä¸­æ–¹ç›¸å…³äº§ä¸šæ”¿ç­–â€œæŸå®³ç¾å›½åˆ©ç›Šâ€ï¼Œå†³å®šå¯¹åŒ…æ‹¬æ™¶ä½“ç®¡ã€é›†æˆç”µè·¯ã€äºŒæç®¡ã€æ”¾å¤§å™¨ç­‰å…³é”®åŠå¯¼ä½“äº§å“åŠ å¾å…³ç¨ã€‚
- **ç‰¹æ®Šå®‰æ’**ï¼š**å½“å‰ç¨ç‡ä¸º0%**ï¼Œä½†**2027å¹´6æœˆèµ·å°†æé«˜ç¨ç‡**ã€‚è¿™ä¸€â€œå»¶è¿Ÿç”Ÿæ•ˆâ€æœºåˆ¶è¢«å¹¿æ³›è§£è¯»ä¸ºç¾æ–¹åœ¨æ–½å‹ä¸ç»´ç¨³ä¹‹é—´å¯»æ±‚å¹³è¡¡ã€‚
- **ä¸­æ–¹å›åº”**ï¼š12æœˆ25æ—¥ï¼Œä¸­å›½å•†åŠ¡éƒ¨å‘è¨€äºº**ä½•å’å‰**åœ¨ä¾‹è¡Œå‘å¸ƒä¼šä¸Š**ä¸¥æ­£äº¤æ¶‰**ï¼Œå¼ºè°ƒï¼š
  - ä¸è®¤åŒç¾æ–¹301è°ƒæŸ¥ç»“è®ºï¼›
  - åšå†³åå¯¹å•è¾¹åŠ å¾å…³ç¨ï¼›
  - æŒ‡å‡ºæ­¤ä¸¾è¿åWTOè§„åˆ™ï¼Œæ‰°ä¹±å…¨çƒèŠ¯ç‰‡ä¾›åº”é“¾ï¼Œâ€œæŸäººä¸åˆ©å·±â€ï¼›
  - è‹¥ç¾æ–¹ä¸€æ„å­¤è¡Œï¼Œä¸­æ–¹å°†é‡‡å–å¿…è¦ååˆ¶æªæ–½ã€‚
- **æˆ˜ç•¥æ„ä¹‰**ï¼šæ­¤ä¸¾åŠ¨å‘ç”Ÿåœ¨ä¸­ç¾2025å¹´11æœˆåˆšè¾¾æˆâ€œå…³ç¨ä¼‘æˆ˜â€ä»…ä¸€ä¸ªå¤šæœˆåï¼Œæ ‡å¿—ç€ç¾å›½å¯¹åç»è´¸ç­–ç•¥è¿›å…¥â€œ**æ–½å‹â€”ä¼‘æˆ˜å¾ªç¯**â€çš„æ–°é˜¶æ®µï¼Œä¹Ÿå‡¸æ˜¾åŠå¯¼ä½“ä½œä¸ºç§‘æŠ€ç«äº‰æ ¸å¿ƒé¢†åŸŸçš„æˆ˜ç•¥åœ°ä½ã€‚

è¯¥äº‹ä»¶ä¸ä»…å…³ä¹ä¸­ç¾åŒè¾¹å…³ç³»èµ°å‘ï¼Œæ›´å¯èƒ½å¯¹**å…¨çƒåŠå¯¼ä½“äº§ä¸šé“¾ã€ç§‘æŠ€ä¼ä¸šå¸ƒå±€åŠ2026å¹´å…³é”®ç¼“å’Œçª—å£æœŸ**äº§ç”Ÿæ·±è¿œå½±å“ï¼Œå› æ­¤è¢«è§†ä¸ºä»Šæ—¥æœ€å…·å…¨å±€æ€§å½±å“çš„å›½é™…æ–°é—»ã€‚
================================== Ai Message ==================================

ä»Šå¤©çš„æ—¥æœŸæ˜¯ï¼š2025å¹´12æœˆ28æ—¥ï¼Œæ˜ŸæœŸæ—¥ã€‚

ä»Šå¤©æœ€é‡è¦çš„ä¸€æ¡æ–°é—»æ˜¯å…³äºç¾å›½å®£å¸ƒå°†å¯¹ä¸­å›½éƒ¨åˆ†åŠå¯¼ä½“äº§å“åŠ å¾301å…³ç¨çš„å†³å®šï¼Œä½†åŒæ—¶è®¾ç½®äº†18ä¸ªæœˆçš„ç¼“å†²æœŸï¼ˆè‡³2027å¹´6æœˆï¼‰ã€‚å…·ä½“æ¥è¯´ï¼Œç¾æ–¹è®¤å®šä¸­å›½ç›¸å…³äº§ä¸šæ”¿ç­–â€œæŸå®³ç¾å›½åˆ©ç›Šâ€ï¼Œå› æ­¤å†³å®šå¯¹åŒ…æ‹¬æ™¶ä½“ç®¡ã€é›†æˆç”µè·¯ã€äºŒæç®¡ã€æ”¾å¤§å™¨ç­‰å…³é”®åŠå¯¼ä½“äº§å“åŠ å¾å…³ç¨ã€‚ç„¶è€Œï¼Œå½“å‰ç¨ç‡ä¸º0%ï¼Œç›´åˆ°2027å¹´6æœˆæ‰ä¼šæé«˜ç¨ç‡ã€‚å¯¹æ­¤ï¼Œä¸­å›½å•†åŠ¡éƒ¨å‘è¨€äººä½•å’å‰åœ¨ä¾‹è¡Œå‘å¸ƒä¼šä¸Šè¡¨ç¤ºä¸è®¤åŒç¾æ–¹301è°ƒæŸ¥ç»“è®ºï¼Œå¹¶åšå†³åå¯¹å•è¾¹åŠ å¾å…³ç¨ï¼ŒæŒ‡å‡ºæ­¤ä¸¾è¿åWTOè§„åˆ™ä¸”æ‰°ä¹±å…¨çƒèŠ¯ç‰‡ä¾›åº”é“¾ã€‚è‹¥ç¾æ–¹æ‰§æ„æ¨è¡Œï¼Œä¸­æ–¹å°†é‡‡å–å¿…è¦ååˆ¶æªæ–½ã€‚è¿™ä¸€äº‹ä»¶ä¸ä»…å½±å“ä¸­ç¾åŒè¾¹å…³ç³»ï¼Œä¹Ÿå¯èƒ½å¯¹å…¨çƒåŠå¯¼ä½“äº§ä¸šé“¾å’Œç§‘æŠ€ä¼ä¸šå¸ƒå±€äº§ç”Ÿæ·±è¿œå½±å“ã€‚
</code></pre><p>æœ¬æ–‡èŠ‚é€‰è‡ª<a href="https://www.luochang.ink/dive-into-langgraph/">ã€ŠLangGraph 1.0 å®Œå…¨æŒ‡å—ã€‹</a>ï¼Œå¦‚æœä½ è§‰å¾—æœ¬æ–‡è¿˜ä¸é”™ï¼Œå¯ä»¥é˜…è¯»åŸç‰ˆæ•™ç¨‹ã€‚</p>
<p>å‚è€ƒï¼š</p>
<ul>
<li><a href="https://datawhalechina.github.io/all-in-rag/#/chapter4/11_hybrid_search">All-in-RAG</a></li>
<li><a href="https://milvus.io/docs/multi-vector-search.md">Multi-Vector Hybrid Search</a></li>
<li><a href="https://docs.trychroma.com/cloud/search-api/hybrid-search">Hybrid Search with RRF</a></li>
</ul>

  </div>

  <div class="post-footer">
    <p style="margin-bottom: 1rem;">æ¬¢è¿å…³æ³¨æˆ‘çš„å…¶å®ƒå‘å¸ƒæ¸ é“ï¼š</p>
    <div class="social-links" style="display: flex; flex-direction: column; gap: 10px;">
      
      <a href="https://twitter.com/_stellar_tide" target="_blank" rel="noopener noreferrer">
        <i class="fab fa-twitter"></i> X
      </a>
      
      
      <a href="https://github.com/luochang212" target="_blank" rel="noopener noreferrer">
        <i class="fab fa-github"></i> GitHub
      </a>
      
      
      <a href="https://www.luochang.ink/images/wechat.jpg" target="_blank" rel="noopener noreferrer">
        <i class="fab fa-weixin"></i> å…¬ä¼—å·
      </a>
      
      <a href="https://www.zhihu.com/people/Fashionable" target="_blank" rel="noopener noreferrer">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" stroke="none" stroke-width="2" 
             stroke-linecap="round" stroke-linejoin="round" style="width: 1em; height: 1em; vertical-align: -0.125em; display: inline-block;">
          <path d="m13.3334,3.60098l0,17.1471l1.79582,0l0.75424,2.13703l3.18459,-2.13703l3.93584,0l0,-17.1471l-9.6705,0zm7.41375,14.87538l-1.79283,0l-2.24777,1.50849l-0.53276,-1.50849l-0.53875,0l0,-12.53483l5.10911,0l0,12.53483l0.00299,0zm-8.56906,-7.18927l-3.97475,0c0.06285,-1.34387 0.1287,-3.12174 0.19754,-5.17496l3.91788,0l-0.00299,-0.24244c0,-0.01796 -0.00599,-0.43998 -0.06884,-0.87097c-0.06285,-0.44896 -0.19754,-1.04457 -0.62854,-1.04457l-6.5727,0c0.13169,-0.61657 0.46991,-2.08615 0.87995,-2.80747l0.19155,-0.33522l-0.3861,-0.02095c-0.02394,0 -0.58663,-0.02694 -1.23912,0.31726c-1.06851,0.56868 -1.5474,1.68807 -1.75691,2.52612c-0.55072,2.18791 -1.33489,3.70837 -1.66712,4.35786c-0.09877,0.19155 -0.15863,0.30529 -0.18557,0.38311c-0.05387,0.14666 -0.02394,0.29332 0.0838,0.38909c0.31427,0.28434 1.14334,-0.0868 1.15232,-0.08979c0.01796,-0.00898 0.03891,-0.01796 0.06585,-0.02993c0.41603,-0.18856 1.64916,-0.74826 2.08914,-2.52911l1.69705,0c0.02095,0.96376 0.09278,4.14236 0.0868,5.17496l-4.22018,0l-0.06285,0.0449c-0.69139,0.50582 -0.91288,1.8916 -0.92185,1.95146l-0.0419,0.27536l4.99837,0c-0.36814,2.34355 -0.79315,3.3941 -1.01763,3.81313c-0.11074,0.20951 -0.21849,0.41902 -0.32025,0.62255c-0.63752,1.26306 -1.29898,2.56802 -3.7802,4.5973c-0.10775,0.0838 -0.20951,0.23944 -0.14367,0.41005c0.07183,0.18856 0.27835,0.27237 0.73629,0.27237c0.16162,0 0.35318,-0.00898 0.58065,-0.02993c1.49352,-0.13169 3.01698,-0.53875 4.04359,-2.6219c0.50882,-1.05056 0.94879,-2.14601 1.31394,-3.25941l4.08549,4.78886l0.14965,-0.35916c0.02394,-0.05687 0.56868,-1.38578 0.15264,-2.87032l-0.01497,-0.05387l-3.23547,-3.68143l-0.65847,0.49684c0.19155,-0.78118 0.31726,-1.49352 0.37413,-2.12805l4.74995,0l0,-0.23944c0,-1.20021 -0.55371,-1.91255 -0.57466,-1.94248l-0.07183,-0.08979z" />
        </svg> çŸ¥ä¹
      </a>

      <a href="/index.xml" target="_blank" rel="noopener noreferrer">
        <i class="fas fa-rss"></i> RSS
      </a>

    </div>
    <div style="margin-bottom: 5rem;"></div>
  </div>

  

<div class="navigation navigation-single">
    
    <a href="/posts/dive_into_langgraph/" class="navigation-prev">
      <i aria-hidden="true" class="fa fa-chevron-left"></i>
      <span class="navigation-tittle">ã€ŠLangGraph 1.0 å®Œå…¨æŒ‡å—ã€‹å‘å¸ƒ</span>
    </a>
    
    
</div>


  

  
    


</article>

        </div>
        
    <script type="text/javascript" async
  src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.7/MathJax.js?config=TeX-MML-AM_CHTML">
  MathJax.Hub.Config({
  tex2jax: {
    inlineMath: [['$','$'], ['\\(','\\)']],
    displayMath: [['$$','$$']],
    processEscapes: true,
    processEnvironments: true,
    skipTags: ['script', 'noscript', 'style', 'textarea', 'pre'],
    TeX: { equationNumbers: { autoNumber: "AMS" },
         extensions: ["AMSmath.js", "AMSsymbols.js"] }
  }
  });
  MathJax.Hub.Queue(function() {
    
    
    
    var all = MathJax.Hub.getAllJax(), i;
    for(i = 0; i < all.length; i += 1) {
        all[i].SourceElement().parentNode.className += ' has-jax';
    }
  });

  MathJax.Hub.Config({
  
  TeX: { equationNumbers: { autoNumber: "AMS" } }
  });
</script>





<script src="https://kit.fontawesome.com/2134995a39.js" crossorigin="anonymous"></script>

    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.13.1/highlight.min.js"></script>
        
    <script type="text/javascript">
        
        hljs.initHighlightingOnLoad();
    </script>
    



<script src="https://cdnjs.cloudflare.com/ajax/libs/tocbot/4.4.2/tocbot.js"></script>
<script type="text/javascript">
  if (tocbot) {
    tocbot.init({
      
      tocSelector: '.toc',
      
      contentSelector: '.post',
      
      headingSelector: 'h2, h3, h4',
      collapseDepth: 4
    });
  }
</script>



    



    </body>
</html>
